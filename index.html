<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Restaurant Bestelsysteem</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f5f5f5;
    margin: 0; padding: 0;
  }
  header {
    background: #333;
    color: #fff;
    padding: 15px 20px;
    text-align: center;
    font-size: 1.7rem;
    font-weight: 700;
    user-select: none;
  }
  #logo {
    height: 40px;
    vertical-align: middle;
    margin-right: 10px;
  }
  main {
    max-width: 900px;
    margin: 25px auto;
    background: #fff;
    padding: 25px;
    border-radius: 10px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.1);
  }
  #tabs {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
  }
  #tabs button {
    flex: 1;
    padding: 10px 0;
    border: none;
    background: #ddd;
    font-weight: 600;
    cursor: pointer;
    border-radius: 6px 6px 0 0;
    transition: background 0.3s;
  }
  #tabs button.active {
    background: #27ae60;
    color: white;
  }
  .tab-content {
    display: none;
  }
  .tab-content.active {
    display: grid;
    grid-template-columns: repeat(auto-fill,minmax(160px,1fr));
    gap: 15px;
  }
  .menu-item {
    background: #e9f5e9;
    border-radius: 8px;
    padding: 15px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    cursor: pointer;
    user-select: none;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }
  .menu-item:hover {
    background: #c3e6c3;
  }
  .menu-item .name {
    font-weight: 700;
    margin-bottom: 6px;
  }
  .menu-item .price {
    font-size: 1rem;
    color: #333;
  }
  .menu-item .add-btn {
    margin-top: 10px;
    background: #27ae60;
    border: none;
    color: white;
    font-weight: 700;
    padding: 6px 0;
    border-radius: 6px;
    cursor: pointer;
    transition: background 0.3s;
  }
  .menu-item .add-btn:hover {
    background: #1e8449;
  }
  #cartBtn {
    position: fixed;
    top: 15px;
    right: 15px;
    background: #27ae60;
    border: none;
    color: white;
    padding: 12px 18px;
    font-weight: 700;
    border-radius: 50px;
    cursor: pointer;
    box-shadow: 0 2px 12px rgba(39, 174, 96, 0.5);
    z-index: 999;
  }
  #cartCount {
    background: #fff;
    color: #27ae60;
    font-weight: 700;
    border-radius: 50%;
    padding: 4px 9px;
    margin-left: 8px;
  }
  .modal {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.4);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1000;
  }
  .modal.active {
    display: flex;
  }
  .modal-content {
    background: #fff;
    border-radius: 12px;
    padding: 20px 30px;
    width: 90%;
    max-width: 450px;
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: 0 8px 30px rgba(0,0,0,0.2);
  }
  .modal-content h2 {
    margin-top: 0;
  }
  .modal-content label {
    display: block;
    margin: 12px 0 6px;
    font-weight: 600;
  }
  .modal-content input[type=number], 
  .modal-content input[type=text], 
  .modal-content textarea, 
  .modal-content select {
    width: 100%;
    padding: 8px 10px;
    font-size: 1rem;
    border-radius: 6px;
    border: 1px solid #ccc;
    resize: vertical;
  }
  .modal-content textarea {
    min-height: 60px;
  }
  .modal-footer {
    margin-top: 20px;
    display: flex;
    justify-content: flex-end;
    gap: 15px;
  }
  .btn {
    background: #27ae60;
    color: white;
    border: none;
    padding: 10px 18px;
    font-weight: 700;
    cursor: pointer;
    border-radius: 6px;
    transition: background 0.3s;
  }
  .btn.cancel {
    background: #aaa;
  }
  .btn:hover {
    background: #1e8449;
  }
  .btn.cancel:hover {
    background: #888;
  }
  #keepOpenScreen {
    text-align: center;
  }
  #keepOpenScreen p {
    font-size: 1.2rem;
    margin-bottom: 10px;
  }
  #orderNumberDisplay {
    font-weight: 900;
    font-size: 3rem;
    color: #27ae60;
    margin-bottom: 15px;
  }
  #operatorView {
    max-width: 700px;
    margin: 0 auto;
    padding: 20px;
    background: #e6ffe6;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0,128,0,0.1);
    display: none;
  }
  #operatorOrders {
    max-height: 400px;
    overflow-y: auto;
    border: 1px solid #27ae60;
    border-radius: 6px;
    padding: 12px;
  }
  .order-item {
    background: white;
    margin-bottom: 10px;
    border-left: 6px solid #27ae60;
    padding: 10px;
    cursor: pointer;
    transition: background 0.2s;
  }
  .order-item:hover {
    background: #c3f0c3;
  }
  #orderDetailModal p {
    margin: 6px 0;
  }
  #orderStatusSelect, #extraText {
    width: 100%;
    margin-top: 6px;
    margin-bottom: 15px;
  }
  #screenView {
    max-width: 650px; 
    margin: 30px auto; 
    background: #fff; 
    padding: 20px; 
    border-radius: 10px; 
    box-shadow:0 4px 12px rgba(0,0,0,0.1); 
    display:none;
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    gap: 20px;
    color: #333;
  }
  #screenPendingOrders, #screenReadyOrders {
    flex: 1;
    border-radius: 8px;
    padding: 15px;
    box-shadow: inset 0 0 10px rgba(150, 75, 0, 0.4);
    min-height: 300px;
    font-size: 1.5rem;
    font-weight: 700;
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
  }
  #screenPendingOrders {
    color: #6f4e37; /* bruin */
    background-color: #f3e9dc;
  }
  #screenReadyOrders {
    color: #2e7d32; /* groen */
    background-color: #d7f0d7;
  }
  #screenPendingOrders div.order-item, #screenReadyOrders div.order-item {
    background: transparent;
    border: 2px solid currentColor;
    border-radius: 6px;
    padding: 12px 18px;
    text-align: center;
    min-width: 60px;
    cursor: default;
    user-select: none;
  }
  #loginButton, #screenLoginButton {
    position: fixed;
    top: 15px;
    background: #27ae60;
    border: none;
    color: white;
    padding: 12px 18px;
    font-weight: 700;
    border-radius: 50px;
    cursor: pointer;
    box-shadow: 0 2px 12px rgba(39, 174, 96, 0.5);
    z-index: 999;
    user-select: none;
  }
  #loginButton {
    right: 90px;
  }
  #screenLoginButton {
    right: 15px;
  }
  #languageSelect {
    position: fixed;
    top: 15px;
    left: 15px;
    padding: 6px 10px;
    font-weight: 700;
    border-radius: 6px;
    border: 1px solid #ccc;
    background: white;
    user-select: none;
  }
  #operatorLogoutBtn, #screenLogoutBtn {
    position: fixed;
    bottom: 15px;
    background: #e74c3c;
    border: none;
    color: white;
    padding: 12px 18px;
    font-weight: 700;
    border-radius: 50px;
    cursor: pointer;
    box-shadow: 0 2px 12px rgba(231, 76, 60, 0.7);
    z-index: 999;
    user-select: none;
  }
  #operatorLogoutBtn {
    left: 15px;
  }
  #screenLogoutBtn {
    left: 90px;
  }
</style>
</head>
<body>

<header>
  <img src="RLogo.jpg" alt="Restaurant Logo" id="logo" />
  Restaurant Bestelsysteem
</header>

<select id="languageSelect" title="Kies taal">
  <option value="en">English</option>
  <option value="nl">Nederlands</option>
</select>

<button id="loginButton">Operator Login</button>
<button id="screenLoginButton">Scherm Login</button>
<button id="cartBtn">Winkelmandje (<span id="cartCount">0</span>)</button>

<button id="operatorLogoutBtn" style="display:none;">Operator Uitloggen</button>
<button id="screenLogoutBtn" style="display:none;">Scherm Uitloggen</button>

<main>

  <div id="tabs">
    <button class="tab-btn active" data-tab="drinks">Dranken</button>
    <button class="tab-btn" data-tab="fingerfood">Fingerfood</button>
    <button class="tab-btn" data-tab="desserts">Desserts</button>
    <button class="tab-btn" data-tab="menus">Menu’s</button>
  </div>

  <section id="drinks" class="tab-content active">
    <div class="menu-item" data-name="Cola Flesje" data-price="1.50">
      <div class="name">Cola Flesje</div>
      <div class="price">€1.50</div>
      <button class="add-btn" onclick="addToCart(event)">Toevoegen</button>
    </div>
    <div class="menu-item" data-name="Water Flesje" data-price="1.00">
      <div class="name">Water Flesje</div>
      <div class="price">€1.00</div>
      <button class="add-btn" onclick="addToCart(event)">Toevoegen</button>
    </div>
  </section>

  <section id="fingerfood" class="tab-content">
    <div class="menu-item" data-name="Pringles Natural" data-price="0.10">
      <div class="name">Pringles Natural</div>
      <div class="price">€0.10 per chip</div>
      <button class="add-btn" onclick="openAmountPopup(event)">Aantal kiezen</button>
    </div>
    <div class="menu-item" data-name="Pringles BBQ" data-price="0.15">
      <div class="name">Pringles BBQ</div>
      <div class="price">€0.15 per chip</div>
      <button class="add-btn" onclick="openAmountPopup(event)">Aantal kiezen</button>
    </div>
  </section>

  <section id="desserts" class="tab-content">
    <div class="menu-item" data-name="Chocoladecake" data-price="2.50">
      <div class="name">Chocoladecake</div>
      <div class="price">€2.50</div>
      <button class="add-btn" onclick="addToCart(event)">Toevoegen</button>
    </div>
  </section>

  <section id="menus" class="tab-content">
    <div class="menu-item" data-name="Menu 1" data-price="8.00">
      <div class="name">Menu 1</div>
      <div class="price">€8.00</div>
      <button class="add-btn" onclick="addToCart(event)">Toevoegen</button>
    </div>
  </section>

</main>

<div class="modal" id="amountModal">
  <div class="modal-content">
    <h2>Aantal kiezen</h2>
    <label for="amountInput">Aantal (max 50):</label>
    <input type="number" id="amountInput" min="1" max="50" value="1" />
    <div class="modal-footer">
      <button class="btn" onclick="confirmAmount()">Bevestigen</button>
      <button class="btn cancel" onclick="closeAmountPopup()">Annuleren</button>
    </div>
  </div>
</div>

<div class="modal" id="cartModal">
  <div class="modal-content">
    <h2>Winkelmandje</h2>
    <div id="cartItems">Winkelmandje is leeg.</div>
    <label for="orderNotes">Opmerkingen / Allergieën (optioneel):</label>
    <textarea id="orderNotes" placeholder="Bijv. Geen pinda's..."></textarea>
    <div class="modal-footer">
      <button class="btn" onclick="placeOrder()">Bestelling plaatsen</button>
      <button class="btn cancel" onclick="closeCart()">Sluiten</button>
    </div>
  </div>
</div>

<div class="modal" id="keepOpenScreen">
  <div class="modal-content" style="text-align:center;">
    <p>Uw bestelling is geplaatst! Uw bestelnummer is:</p>
    <div id="orderNumberDisplay">#0</div>
    <p>Laat deze website open totdat uw bestelling klaar is.</p>
    <button class="btn" onclick="closeKeepOpen()">Sluiten</button>
  </div>
</div>

<div class="modal" id="loginModal">
  <div class="modal-content">
    <h2>Operator Login</h2>
    <label for="loginUser">Gebruikersnaam:</label>
    <input type="text" id="loginUser" autocomplete="username" />
    <label for="loginPass">Wachtwoord:</label>
    <input type="password" id="loginPass" autocomplete="current-password" />
    <div class="modal-footer">
      <button class="btn" onclick="operatorLogin()">Inloggen</button>
      <button class="btn cancel" onclick="closeLogin()">Annuleren</button>
    </div>
  </div>
</div>

<div id="operatorView">
  <h2>Operator Bestellingen</h2>
  <div id="operatorOrders">Geen bestellingen.</div>
  <div class="modal-footer" style="margin-top:20px;">
    <button class="btn" onclick="logoutOperator()" id="operatorLogoutBtn">Uitloggen</button>
  </div>
</div>

<div class="modal" id="orderDetailModal">
  <div class="modal-content">
    <h3>Bestelling Details</h3>
    <div id="orderDetailContent"></div>
    <label for="orderStatusSelect">Status:</label>
    <select id="orderStatusSelect">
      <option value="pending">In Behandeling</option>
      <option value="ready">Klaar</option>
      <option value="delayed">Kan langer duren</option>
    </select>
    <label for="extraText">Extra tekst (communicatie):</label>
    <textarea id="extraText" placeholder="Voeg hier een tekst toe..."></textarea>
    <div class="modal-footer">
      <button class="btn" onclick="updateOrder()">Opslaan</button>
      <button class="btn cancel" onclick="deleteOrder()">Verwijderen</button>
      <button class="btn cancel" onclick="closeOrderDetail()">Sluiten</button>
    </div>
  </div>
</div>

<div class="modal" id="screenLoginModal">
  <div class="modal-content">
    <h2>Scherm Account Login</h2>
    <label for="screenUser">Gebruikersnaam:</label>
    <input type="text" id="screenUser" autocomplete="username" />
    <label for="screenPass">Wachtwoord:</label>
    <input type="password" id="screenPass" autocomplete="current-password" />
    <div class="modal-footer">
      <button class="btn" onclick="screenLogin()">Inloggen</button>
      <button class="btn cancel" onclick="closeScreenLogin()">Annuleren</button>
    </div>
  </div>
</div>

<div id="screenView">
  <div>
    <h3>In Behandeling</h3>
    <div id="screenPendingOrders">Laden...</div>
  </div>
  <div>
    <h3>Klaar</h3>
    <div id="screenReadyOrders">Laden...</div>
  </div>
  <button class="btn" style="margin-top:15px;" onclick="screenLogout()" id="screenLogoutBtn">Uitloggen Scherm</button>
</div>

<audio id="doneSound" src="Sounds/DoneSoundForScreen.mp3" preload="auto"></audio>

<script>
(() => {
  const BIN_ID = '688f6efe7b4b8670d8ac3f46';
  const API_KEY = '$2a$10$XpZeyd.RhynC0Ie0VWma7uJPbMYdUAIHuG24Smc5V0C5LU5d11H5O';

  let ordersData = { counter: 0, orders: [] };

  let cart = [];
  let currentAmountItem = null;
  let editingOrder = null;
  let loggedInOperator = false;
  let loggedInScreen = false;
  let language = 'en';

  // DOM elementen
  const tabs = document.querySelectorAll('#tabs button');
  const cartBtn = document.getElementById('cartBtn');
  const cartCount = document.getElementById('cartCount');
  const cartModal = document.getElementById('cartModal');
  const cartItemsDiv = document.getElementById('cartItems');
  const amountModal = document.getElementById('amountModal');
  const amountInput = document.getElementById('amountInput');
  const keepOpenScreen = document.getElementById('keepOpenScreen');
  const orderNumberDisplay = document.getElementById('orderNumberDisplay');
  const orderNotes = document.getElementById('orderNotes');

  const loginButton = document.getElementById('loginButton');
  const loginModal = document.getElementById('loginModal');
  const loginUser = document.getElementById('loginUser');
  const loginPass = document.getElementById('loginPass');
  const operatorView = document.getElementById('operatorView');
  const operatorOrdersDiv = document.getElementById('operatorOrders');
  const operatorLogoutBtn = document.getElementById('operatorLogoutBtn');

  const orderDetailModal = document.getElementById('orderDetailModal');
  const orderDetailContent = document.getElementById('orderDetailContent');
  const orderStatusSelect = document.getElementById('orderStatusSelect');
  const extraText = document.getElementById('extraText');

  const screenLoginButton = document.getElementById('screenLoginButton');
  const screenLoginModal = document.getElementById('screenLoginModal');
  const screenUser = document.getElementById('screenUser');
  const screenPass = document.getElementById('screenPass');
  const screenView = document.getElementById('screenView');
  const screenPendingOrders = document.getElementById('screenPendingOrders');
  const screenReadyOrders = document.getElementById('screenReadyOrders');
  const screenLogoutBtn = document.getElementById('screenLogoutBtn');
  const doneSound = document.getElementById('doneSound');

  const languageSelect = document.getElementById('languageSelect');

  // Taal opslaan/laden
  function loadLanguage() {
    const saved = localStorage.getItem('language');
    if(saved) {
      language = saved;
      languageSelect.value = language;
    }
  }
  function saveLanguage() {
    localStorage.setItem('language', language);
  }
  languageSelect.addEventListener('change', () => {
    language = languageSelect.value;
    saveLanguage();
  });
  loadLanguage();

  // Tabs
  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      tabs.forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
      const target = tab.dataset.tab;
      document.getElementById(target).classList.add('active');
    });
  });

  // Winkelmandje functies
  function updateCartCount() {
    let totalCount = cart.reduce((acc, i) => acc + i.amount, 0);
    cartCount.textContent = totalCount;
  }

  function addToCart(event) {
    const itemDiv = event.target.closest('.menu-item');
    const name = itemDiv.dataset.name;
    const price = parseFloat(itemDiv.dataset.price);

    if(name.toLowerCase().includes('pringles')) {
      openAmountPopup(event);
      currentAmountItem = {name, price};
      return;
    }

    let found = cart.find(i => i.name === name);
    if(found) found.amount++;
    else cart.push({name, price, amount: 1});
    updateCartCount();
  }

  function openAmountPopup(event) {
    const itemDiv = event.target.closest('.menu-item');
    const name = itemDiv.dataset.name;
    const price = parseFloat(itemDiv.dataset.price);
    currentAmountItem = {name, price};
    amountInput.value = 1;
    amountModal.classList.add('active');
  }
  function closeAmountPopup() {
    amountModal.classList.remove('active');
    currentAmountItem = null;
  }
  function confirmAmount() {
    let amount = parseInt(amountInput.value);
    if(isNaN(amount) || amount < 1) amount = 1;
    if(amount > 50) amount = 50;
    if(!currentAmountItem) return;
    let found = cart.find(i => i.name === currentAmountItem.name);
    if(found) found.amount += amount;
    else cart.push({name: currentAmountItem.name, price: currentAmountItem.price, amount});
    updateCartCount();
    closeAmountPopup();
  }

  cartBtn.addEventListener('click', () => {
    renderCartItems();
    cartModal.classList.add('active');
  });
  function closeCart() {
    cartModal.classList.remove('active');
  }
  function renderCartItems() {
    cartItemsDiv.innerHTML = '';
    if(cart.length === 0) {
      cartItemsDiv.textContent = 'Winkelmandje is leeg.';
      return;
    }
    cart.forEach((item,i) => {
      const div = document.createElement('div');
      div.style.marginBottom = '10px';
      div.textContent = `${item.name} x${item.amount} - €${(item.price*item.amount).toFixed(2)}`;
      cartItemsDiv.appendChild(div);
    });
  }

  // Bestelling plaatsen
  async function placeOrder() {
    if(cart.length === 0) {
      alert('Je winkelmandje is leeg.');
      return;
    }
    const notes = orderNotes.value.trim();

    ordersData.counter = parseInt(ordersData.counter) || 0;
    ordersData.counter++;

    const newOrder = {
      id: ordersData.counter,
      items: cart.map(i => ({name: i.name, price: i.price, amount: i.amount})),
      notes: notes,
      status: 'pending',
      extraText: '',
      time: new Date().toISOString()
    };

    ordersData.orders.push(newOrder);

    try {
      await saveOrdersData();
    } catch(e) {
      alert('Fout bij opslaan bestelling, probeer opnieuw.');
      return;
    }

    cart = [];
    orderNotes.value = '';
    updateCartCount();
    closeCart();

    orderNumberDisplay.textContent = '#' + newOrder.id;
    keepOpenScreen.classList.add('active');

    pollOrders();
  }

  function closeKeepOpen() {
    keepOpenScreen.classList.remove('active');
  }

  // JSONBin functies
  async function loadOrdersData() {
    try {
      const res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
        headers: { 'X-Master-Key': API_KEY }
      });
      if(!res.ok) throw new Error('Load failed');
      const json = await res.json();
      if(json && json.record) {
        ordersData = json.record;
        ordersData.counter = parseInt(ordersData.counter) || 0;
        if(!ordersData.orders) ordersData.orders = [];
      }
    } catch(e) {
      ordersData = { counter: 0, orders: [] };
    }
  }
  async function saveOrdersData() {
    const res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json',
        'X-Master-Key': API_KEY,
        'X-Bin-Versioning': 'false'
      },
      body: JSON.stringify(ordersData)
    });
    if(!res.ok) throw new Error('Save failed');
  }

  // Operator login/logout
  loginButton.addEventListener('click', () => {
    loginModal.classList.add('active');
  });
  function closeLogin() {
    loginModal.classList.remove('active');
    loginUser.value = '';
    loginPass.value = '';
  }
  function operatorLogin() {
    if(loginUser.value === 'Operator' && loginPass.value === '8008') {
      loggedInOperator = true;
      closeLogin();
      showOperatorView();
      updateUIForLogin();
    } else {
      alert('Foutieve inloggegevens');
    }
  }
  function logoutOperator() {
    loggedInOperator = false;
    hideOperatorView();
    updateUIForLogin();
  }
  function updateUIForLogin() {
    if(loggedInOperator || loggedInScreen) {
      loginButton.style.display = 'none';
      screenLoginButton.style.display = loggedInScreen ? 'none' : 'inline-block';

      if(loggedInOperator) {
        document.querySelector('main').style.display = 'none';
      } else {
        document.querySelector('main').style.display = 'block';
      }
    } else {
      loginButton.style.display = 'inline-block';
      screenLoginButton.style.display = 'inline-block';
      document.querySelector('main').style.display = 'block';
    }
  }

  // Operator view
  function showOperatorView() {
    renderOperatorOrders();
    operatorView.style.display = 'block';
  }
  function hideOperatorView() {
    operatorView.style.display = 'none';
  }
  function renderOperatorOrders() {
    if(ordersData.orders.length === 0) {
      operatorOrdersDiv.textContent = 'Geen bestellingen.';
      return;
    }
    operatorOrdersDiv.innerHTML = '';
    ordersData.orders.forEach(order => {
      const div = document.createElement('div');
      div.className = 'order-item';
      div.textContent = `#${order.id} - ${new Date(order.time).toLocaleTimeString()} - Status: ${translateStatus(order.status)}`;
      div.onclick = () => openOrderDetail(order.id);
      operatorOrdersDiv.appendChild(div);
    });
  }

  function translateStatus(status) {
    switch(status) {
      case 'pending': return 'In Behandeling';
      case 'ready': return 'Klaar';
      case 'delayed': return 'Kan langer duren';
      default: return status;
    }
  }

  // Order detail
  function openOrderDetail(orderId) {
    const order = ordersData.orders.find(o => o.id === orderId);
    if(!order) return;
    editingOrder = order;
    orderDetailContent.innerHTML = '';
    order.items.forEach(i => {
      const p = document.createElement('p');
      p.textContent = `${i.name} x${i.amount} - €${(i.price * i.amount).toFixed(2)}`;
      orderDetailContent.appendChild(p);
    });
    orderStatusSelect.value = order.status || 'pending';
    extraText.value = order.extraText || '';
    orderDetailModal.classList.add('active');
  }
  function closeOrderDetail() {
    orderDetailModal.classList.remove('active');
    editingOrder = null;
  }
  async function updateOrder() {
    if(!editingOrder) return;
    editingOrder.status = orderStatusSelect.value;
    editingOrder.extraText = extraText.value.trim();
    try {
      await saveOrdersData();
      closeOrderDetail();
      renderOperatorOrders();
      renderScreenOrders();
    } catch(e) {
      alert('Fout bij opslaan status');
    }
  }
  async function deleteOrder() {
    if(!editingOrder) return;
    if(!confirm(`Weet je zeker dat je bestelling #${editingOrder.id} wilt verwijderen?`)) return;
    ordersData.orders = ordersData.orders.filter(o => o.id !== editingOrder.id);
    try {
      await saveOrdersData();
      closeOrderDetail();
      renderOperatorOrders();
      renderScreenOrders();
    } catch(e) {
      alert('Fout bij verwijderen');
    }
  }

  // Scherm account login/logout
  screenLoginButton.addEventListener('click', () => {
    screenLoginModal.classList.add('active');
  });
  function closeScreenLogin() {
    screenLoginModal.classList.remove('active');
    screenUser.value = '';
    screenPass.value = '';
  }
  function screenLogin() {
    if(screenUser.value === 'OperatorScreen' && screenPass.value === '8008') {
      loggedInScreen = true;
      closeScreenLogin();
      showScreenView();
      updateUIForLogin();
    } else {
      alert('Foutieve inloggegevens');
    }
  }
  function screenLogout() {
    loggedInScreen = false;
    hideScreenView();
    updateUIForLogin();
  }
  function showScreenView() {
    screenView.style.display = 'flex';
    renderScreenOrders();
  }
  function hideScreenView() {
    screenView.style.display = 'none';
  }
  function renderScreenOrders() {
    screenPendingOrders.innerHTML = '';
    screenReadyOrders.innerHTML = '';
    ordersData.orders.forEach(order => {
      const orderId = parseInt(order.id);
      if(isNaN(orderId)) return;
      const div = document.createElement('div');
      div.className = 'order-item';
      div.textContent = `#${orderId}`;
      if(order.status === 'ready') {
        screenReadyOrders.appendChild(div);
      } else {
        screenPendingOrders.appendChild(div);
      }
    });
  }

  // Polling realtime
  let pollInterval = null;
  async function pollOrders() {
    try {
      const res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
        headers: {
          'X-Master-Key': API_KEY
        }
      });
      if(!res.ok) throw new Error('Polling failed');
      const json = await res.json();
      if(json && json.record) {
        const oldReadyCount = ordersData.orders.filter(o => o.status === 'ready').length;
        ordersData = json.record;
        ordersData.counter = parseInt(ordersData.counter) || 0;
        if(!ordersData.orders) ordersData.orders = [];

        renderOperatorOrders();
        renderScreenOrders();

        // Check if new ready order appeared for sound
        const newReadyCount = ordersData.orders.filter(o => o.status === 'ready').length;
        if(newReadyCount > oldReadyCount && loggedInScreen) {
          doneSound.play();
        }
      }
    } catch(e) {
      // fail silently
    }
  }

  // Start polling elke 4 sec
  setInterval(pollOrders, 4000);

  // Init
  async function init() {
    await loadOrdersData();
    updateCartCount();
    updateUIForLogin();
  }
  init();

  // Bestelling na verwijderen opmerking probleem opgelost omdat we counter opslaan en niet aanpassen bij verwijderen
  // Geen nummers herschikken

  // Bestelling nummer NAN of NaF probleem opgelost door altijd parseInt

  // Export functies globaal voor onclick inline
  window.addToCart = addToCart;
  window.openAmountPopup = openAmountPopup;
  window.closeAmountPopup = closeAmountPopup;
  window.confirmAmount = confirmAmount;
  window.placeOrder = placeOrder;
  window.closeCart = closeCart;
  window.closeKeepOpen = closeKeepOpen;
  window.operatorLogin = operatorLogin;
  window.closeLogin = closeLogin;
  window.logoutOperator = logoutOperator;
  window.openOrderDetail = openOrderDetail;
  window.closeOrderDetail = closeOrderDetail;
  window.updateOrder = updateOrder;
  window.deleteOrder = deleteOrder;
  window.screenLogin = screenLogin;
  window.closeScreenLogin = closeScreenLogin;
  window.screenLogout = screenLogout;

})();
</script>

</body>
</html>
