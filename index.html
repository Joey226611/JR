<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Joey's Restaurant Bestelsysteem</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  .hidden { display: none; }
  .tab-btn {
    @apply px-4 py-2 rounded hover:bg-yellow-300 transition cursor-pointer;
  }
  .tab-btn-active {
    @apply bg-yellow-400 text-black font-bold;
  }
</style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">

<header class="flex justify-between items-center p-4 bg-white shadow">
  <img src="RLogo.jpg" alt="Logo" class="h-12" />
  <div>
    <button id="operatorLoginBtn" class="bg-yellow-400 px-3 py-1 rounded hover:bg-yellow-500 transition mr-2">Operator Login</button>
    <button id="screenLoginBtn" class="bg-yellow-400 px-3 py-1 rounded hover:bg-yellow-500 transition">Scherm Login</button>
  </div>
</header>

<!-- Gasten Bestelscherm -->
<main id="guestView" class="flex-grow p-4 max-w-3xl mx-auto">
  <nav class="flex space-x-2 mb-4">
    <button class="tab-btn tab-btn-active" data-tab="drinks">Drinks</button>
    <button class="tab-btn" data-tab="fingerfood">Fingerfood</button>
    <button class="tab-btn" data-tab="desserts">Desserts</button>
    <button class="tab-btn" data-tab="menus">Menus</button>
  </nav>

  <section id="drinks" class="tab-content">
    <h2 class="text-xl font-semibold mb-2">Drinks</h2>
    <div class="grid grid-cols-2 gap-4">
      <button class="bg-white p-4 rounded shadow hover:bg-yellow-100 transition" data-name="Cola" data-price="1.5">Cola - €1.50</button>
      <button class="bg-white p-4 rounded shadow hover:bg-yellow-100 transition" data-name="Water" data-price="1.0">Water - €1.00</button>
    </div>
  </section>

  <section id="fingerfood" class="tab-content hidden">
    <h2 class="text-xl font-semibold mb-2">Fingerfood</h2>
    <div class="grid grid-cols-2 gap-4">
      <button class="bg-white p-4 rounded shadow hover:bg-yellow-100 transition" data-name="Pringles Natural" data-price="0.1">Pringles Natural (per chip) - €0.10</button>
      <button class="bg-white p-4 rounded shadow hover:bg-yellow-100 transition" data-name="Pringles BBQ" data-price="0.12">Pringles BBQ (per chip) - €0.12</button>
    </div>
  </section>

  <section id="desserts" class="tab-content hidden">
    <h2 class="text-xl font-semibold mb-2">Desserts</h2>
    <p>Coming soon!</p>
  </section>

  <section id="menus" class="tab-content hidden">
    <h2 class="text-xl font-semibold mb-2">Menus</h2>
    <p>Coming soon!</p>
  </section>

  <!-- Winkelmandje icoon -->
  <button id="cartBtn" class="fixed bottom-6 right-6 bg-yellow-400 p-5 rounded-full shadow-lg hover:bg-yellow-500 transition z-40">🛒</button>
</main>

<!-- Popup om aantal te kiezen en afrekenen/doorshoppen -->
<div id="itemPopup" class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50">
  <div class="bg-white rounded-lg p-6 w-80 max-w-full shadow-lg">
    <h3 id="popupItemName" class="text-xl font-bold mb-4"></h3>
    <label class="block mb-2">Aantal (max 50):</label>
    <input id="popupQty" type="number" min="1" max="50" value="1" class="border rounded px-3 py-1 w-full mb-4" />
    <div class="flex justify-between">
      <button id="popupAddMore" class="bg-gray-300 px-4 py-2 rounded hover:bg-gray-400 transition">Verder winkelen</button>
      <button id="popupCheckout" class="bg-yellow-400 px-4 py-2 rounded hover:bg-yellow-500 transition">Afrekenen</button>
    </div>
  </div>
</div>

<!-- Winkelmandje view -->
<div id="cartView" class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50">
  <div class="bg-white rounded-lg p-6 w-96 max-w-full shadow-lg max-h-[80vh] overflow-auto flex flex-col">
    <h3 class="text-2xl font-bold mb-4">Winkelmandje</h3>
    <ul id="cartItems" class="flex-grow overflow-auto space-y-2"></ul>

    <label for="specialInstructions" class="mt-4 font-semibold">Opmerkingen / Speciale wensen (optioneel):</label>
    <textarea id="specialInstructions" rows="3" class="border rounded px-3 py-2 w-full mb-4" placeholder="Bijv. geen peper, extra saus, etc."></textarea>

    <div class="mt-4 flex justify-between">
      <button id="placeOrderBtn" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 transition">Bestelling plaatsen</button>
      <button id="closeCartBtn" class="bg-gray-300 px-4 py-2 rounded hover:bg-gray-400 transition">Verder winkelen</button>
    </div>
  </div>
</div>

<!-- Keep Open view (na bestellen) -->
<main id="keepOpenView" class="hidden flex flex-col justify-center items-center flex-grow p-4 max-w-xl mx-auto text-center">
  <h2 class="text-3xl font-bold mb-6">Bedankt voor je bestelling!</h2>
  <p class="mb-4 text-lg">Je bestellingnummer is:</p>
  <p id="orderNumberDisplay" class="text-yellow-400 font-bold text-5xl mb-8"></p>
  <p class="text-gray-700 mb-8">Laat deze website open tot uw bestelling er is.</p>
</main>

<!-- Operator login modal -->
<div id="operatorLoginModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50">
  <div class="bg-white rounded-lg p-6 w-80 max-w-full shadow-lg">
    <h3 class="text-xl font-bold mb-4">Operator Login</h3>
    <input id="operatorUsername" placeholder="Gebruikersnaam" class="border rounded px-3 py-2 w-full mb-3" />
    <input id="operatorPassword" type="password" placeholder="Wachtwoord" class="border rounded px-3 py-2 w-full mb-5" />
    <div class="flex justify-end space-x-2">
      <button id="operatorLoginCancel" class="bg-gray-300 px-4 py-2 rounded hover:bg-gray-400 transition">Annuleren</button>
      <button id="operatorLoginSubmit" class="bg-yellow-400 px-4 py-2 rounded hover:bg-yellow-500 transition">Login</button>
    </div>
  </div>
</div>

<!-- Operator bestellingen scherm -->
<main id="operatorView" class="hidden p-6 max-w-4xl mx-auto flex-grow flex flex-col">
  <h2 class="text-3xl font-bold mb-6">Operator: Bestellingen Overzicht</h2>
  <button id="operatorLogoutBtn" class="self-end bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 transition mb-4">Logout</button>
  <div id="ordersList" class="flex flex-col gap-4 overflow-auto flex-grow"></div>

  <!-- Bestelling detail modal -->
  <div id="orderDetailModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50">
    <div class="bg-white rounded-lg p-6 w-96 max-w-full shadow-lg max-h-[80vh] overflow-auto flex flex-col">
      <h3 class="text-2xl font-bold mb-4">Bestelling Details</h3>
      <div id="orderDetailsContent" class="flex-grow overflow-auto"></div>
      <label class="block mt-4 mb-1 font-semibold">Status:</label>
      <select id="orderStatusSelect" class="border rounded px-3 py-2 w-full mb-3">
        <option value="pending">In Behandeling</option>
        <option value="ready">Klaar</option>
        <option value="delay">Kan (tijdstip) langer duren</option>
      </select>
      <label class="block mb-1 font-semibold">Extra tekst (optioneel):</label>
      <textarea id="orderExtraText" rows="3" class="border rounded px-3 py-2 w-full mb-4" placeholder="Bijv. 'Wordt nu bereid door chef Mario 🍝'"></textarea>
      <div class="flex justify-between">
        <button id="deleteOrderBtn" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 transition">Bestelling Verwijderen</button>
        <button id="closeOrderDetailBtn" class="bg-gray-300 px-4 py-2 rounded hover:bg-gray-400 transition">Sluiten</button>
      </div>
    </div>
  </div>
</main>

<!-- Scherm Account login modal -->
<div id="screenLoginModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50">
  <div class="bg-white rounded-lg p-6 w-80 max-w-full shadow-lg">
    <h3 class="text-xl font-bold mb-4">Scherm Account Login</h3>
    <input id="screenUsername" placeholder="Gebruikersnaam" class="border rounded px-3 py-2 w-full mb-3" />
    <input id="screenPassword" type="password" placeholder="Wachtwoord" class="border rounded px-3 py-2 w-full mb-5" />
    <div class="flex justify-end space-x-2">
      <button id="screenLoginCancel" class="bg-gray-300 px-4 py-2 rounded hover:bg-gray-400 transition">Annuleren</button>
      <button id="screenLoginSubmit" class="bg-yellow-400 px-4 py-2 rounded hover:bg-yellow-500 transition">Login</button>
    </div>
  </div>
</div>

<!-- Scherm Account view -->
<main id="screenView" class="hidden p-6 max-w-6xl mx-auto flex-grow flex flex-col bg-gray-50">
  <h2 class="text-4xl font-bold mb-6 text-center">Scherm Account: Bestellingen Overzicht</h2>
  <button id="screenLogoutBtn" class="self-end bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 transition mb-4">Logout</button>
  <div class="grid grid-cols-2 gap-8">
    <section>
      <h3 class="text-2xl font-semibold mb-4 text-yellow-500">In Behandeling</h3>
      <div id="screenPendingOrders" class="space-y-3 bg-white p-4 rounded shadow max-h-[70vh] overflow-auto"></div>
    </section>
    <section>
      <h3 class="text-2xl font-semibold mb-4 text-green-500">Klaar</h3>
      <div id="screenReadyOrders" class="space-y-3 bg-white p-4 rounded shadow max-h-[70vh] overflow-auto"></div>
    </section>
  </div>
</main>

<script>
(() => {
  // STATE & CONFIG
  let cart = [];
  let currentPopupItem = null;
  let orders = [];
  let selectedOrderIndex = null;
  let operatorLoggedIn = false;
  let lastOrderNumber = null;

  let screenLoggedIn = false;
  let screenOrders = [];
  let lastReadyCount = 0;

  const JSONBIN_ID = '688f6efe7b4b8670d8ac3f46';
  const JSONBIN_APIKEY = '$2a$10$XpZeyd.RhynC0Ie0VWma7uJPbMYdUAIHuG24Smc5V0C5LU5d11H5O';

  // DOM ELEMENTS GASTEN
  const guestView = document.getElementById('guestView');
  const operatorView = document.getElementById('operatorView');
  const keepOpenView = document.getElementById('keepOpenView');
  const screenView = document.getElementById('screenView');

  // GASTEN UI
  const cartBtn = document.getElementById('cartBtn');
  const cartView = document.getElementById('cartView');
  const cartItemsList = document.getElementById('cartItems');
  const placeOrderBtn = document.getElementById('placeOrderBtn');
  const closeCartBtn = document.getElementById('closeCartBtn');
  const specialInstructionsInput = document.getElementById('specialInstructions');

  const itemPopup = document.getElementById('itemPopup');
  const popupItemName = document.getElementById('popupItemName');
  const popupQty = document.getElementById('popupQty');
  const popupAddMore = document.getElementById('popupAddMore');
  const popupCheckout = document.getElementById('popupCheckout');

  const orderNumberDisplay = document.getElementById('orderNumberDisplay');

  // OPERATOR UI
  const operatorLoginBtn = document.getElementById('operatorLoginBtn');
  const operatorLoginModal = document.getElementById('operatorLoginModal');
  const operatorLoginCancel = document.getElementById('operatorLoginCancel');
  const operatorLoginSubmit = document.getElementById('operatorLoginSubmit');
  const operatorLogoutBtn = document.getElementById('operatorLogoutBtn');
  const ordersList = document.getElementById('ordersList');
  const orderDetailModal = document.getElementById('orderDetailModal');
  const orderDetailsContent = document.getElementById('orderDetailsContent');
  const orderStatusSelect = document.getElementById('orderStatusSelect');
  const orderExtraText = document.getElementById('orderExtraText');
  const deleteOrderBtn = document.getElementById('deleteOrderBtn');
  const closeOrderDetailBtn = document.getElementById('closeOrderDetailBtn');

  // SCREEN ACCOUNT UI
  const screenLoginBtn = document.getElementById('screenLoginBtn');
  const screenLoginModal = document.getElementById('screenLoginModal');
  const screenUsernameInput = document.getElementById('screenUsername');
  const screenPasswordInput = document.getElementById('screenPassword');
  const screenLoginCancel = document.getElementById('screenLoginCancel');
  const screenLoginSubmit = document.getElementById('screenLoginSubmit');
  const screenLogoutBtn = document.getElementById('screenLogoutBtn');
  const screenPendingOrdersDiv = document.getElementById('screenPendingOrders');
  const screenReadyOrdersDiv = document.getElementById('screenReadyOrders');

  // TABS GASTEN
  const tabButtons = document.querySelectorAll('.tab-btn');
  const tabContents = document.querySelectorAll('.tab-content');

  // SOUND (voor scherm account)
  const soundUrl = 'Sounds/DoneSoundForScreen.mp3';

  // ------------- FUNCTIONS ---------------------

  // TAB SWITCHING GASTEN
  tabButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      tabButtons.forEach(b => b.classList.remove('tab-btn-active'));
      btn.classList.add('tab-btn-active');
      const tab = btn.getAttribute('data-tab');
      tabContents.forEach(tc => {
        if (tc.id === tab) tc.classList.remove('hidden');
        else tc.classList.add('hidden');
      });
    });
  });

  // FETCH ORDERS
  async function fetchOrders() {
    try {
      const res = await fetch(`https://api.jsonbin.io/v3/b/${JSONBIN_ID}/latest`, {
        headers: { 'X-Master-Key': JSONBIN_APIKEY }
      });
      const data = await res.json();
      orders = data.record.orders || [];
      renderOrdersList();
      if(screenLoggedIn) {
        screenOrders = orders;
        renderScreenOrders();
      }
    } catch (e) {
      console.error('Error fetching orders:', e);
    }
  }

  // SAVE ORDERS
  async function saveOrders() {
    try {
      await fetch(`https://api.jsonbin.io/v3/b/${JSONBIN_ID}`, {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json',
          'X-Master-Key': JSONBIN_APIKEY,
        },
        body: JSON.stringify({ orders }),
      });
    } catch (e) {
      console.error('Error saving orders:', e);
    }
  }

  // GASTEN: SETUP ITEM BUTTONS
  function setupItemButtons() {
    const buttons = document.querySelectorAll('[data-name]');
    buttons.forEach(btn => {
      btn.addEventListener('click', () => {
        if (operatorLoggedIn || screenLoggedIn) return; // Operator/screen mag niet bestellen
        const item = {
          name: btn.getAttribute('data-name'),
          price: parseFloat(btn.getAttribute('data-price'))
        };
        openItemPopup(item);
      });
    });
  }

  // ADD TO CART
  function addToCart(item, qty) {
    if (qty < 1 || qty > 50) return alert('Aantal moet tussen 1 en 50 zijn');
    const existing = cart.find(i => i.name === item.name);
    if (existing) {
      existing.qty += qty;
    } else {
      cart.push({ ...item, qty });
    }
    alert(`${qty}x ${item.name} toegevoegd aan winkelmandje!`);
  }

  // OPEN/CLOSE ITEM POPUP
  function openItemPopup(item) {
    currentPopupItem = item;
    popupItemName.textContent = item.name;
    popupQty.value = 1;
    itemPopup.classList.remove('hidden');
  }
  function closeItemPopup() {
    itemPopup.classList.add('hidden');
  }

  // RENDER CART ITEMS
  function renderCartItems() {
    cartItemsList.innerHTML = '';
    cart.forEach((item, i) => {
      const li = document.createElement('li');
      li.className = 'flex justify-between items-center bg-yellow-50 p-2 rounded';
      li.innerHTML = `
        <span>${item.qty}x ${item.name}</span>
        <span>€${(item.price * item.qty).toFixed(2)}</span>
      `;
      cartItemsList.appendChild(li);
    });
  }

  // OPEN/CLOSE CART VIEW
  function openCartView() {
    if (cart.length === 0) {
      alert('Je winkelmandje is leeg!');
      return;
    }
    renderCartItems();
    cartView.classList.remove('hidden');
  }
  function closeCartView() {
    cartView.classList.add('hidden');
  }

  // PLACE ORDER
  async function placeOrder() {
    if (cart.length === 0) {
      alert('Je winkelmandje is leeg!');
      return;
    }
    const now = new Date();
    const timeStr = now.toLocaleTimeString('nl-NL', { hour: '2-digit', minute: '2-digit' });
    const order = {
      time: timeStr,
      items: cart.map(i => ({ name: i.name, price: i.price, qty: i.qty })),
      status: 'pending',
      extraText: '',
      specialInstructions: specialInstructionsInput.value.trim() || '',
    };
    orders.push(order);
    await saveOrders();
    await fetchOrders();
    cart = [];
    specialInstructionsInput.value = '';
    closeCartView();

    // Toon keepOpenView met bestelnummer (index+1)
    lastOrderNumber = orders.length;
    orderNumberDisplay.textContent = lastOrderNumber;
    guestView.classList.add('hidden');
    keepOpenView.classList.remove('hidden');
  }

  // OPERATOR LOGIN FLOW
  function openOperatorLogin() {
    operatorLoginModal.classList.remove('hidden');
  }
  function closeOperatorLogin() {
    operatorLoginModal.classList.add('hidden');
  }
  function operatorLogin() {
    const user = document.getElementById('operatorUsername').value.trim();
    const pass = document.getElementById('operatorPassword').value.trim();
    if (user === 'Operator' && pass === '8008') {
      operatorLoggedIn = true;
      closeOperatorLogin();
      guestView.classList.add('hidden');
      keepOpenView.classList.add('hidden');
      screenView.classList.add('hidden');
      operatorView.classList.remove('hidden');
      fetchOrders();
    } else {
      alert('Verkeerde gebruikersnaam of wachtwoord');
    }
  }
  function operatorLogout() {
    operatorLoggedIn = false;
    operatorView.classList.add('hidden');
    guestView.classList.remove('hidden');
  }

  // RENDER ORDERS LIST OPERATOR
  function renderOrdersList() {
    if (!operatorLoggedIn) return;
    ordersList.innerHTML = '';
    if (orders.length === 0) {
      ordersList.innerHTML = '<p class="italic text-gray-500">Geen bestellingen</p>';
      return;
    }
    orders.forEach((order, i) => {
      const div = document.createElement('div');
      div.className = 'bg-yellow-50 p-4 rounded shadow cursor-pointer hover:bg-yellow-100 flex justify-between items-center';
      div.innerHTML = `
        <div>Bestelling #${i + 1} - ${order.time}</div>
        <button class="bg-yellow-400 px-3 py-1 rounded hover:bg-yellow-500 transition text-sm">Bekijk</button>
      `;
      div.querySelector('button').addEventListener('click', e => {
        e.stopPropagation();
        openOrderDetail(i);
      });
      ordersList.appendChild(div);
    });
  }

  // OPEN ORDER DETAIL MODAL
  function openOrderDetail(index) {
    selectedOrderIndex = index;
    const order = orders[index];
    orderDetailsContent.innerHTML = '';
    order.items.forEach(item => {
      const p = document.createElement('p');
      p.textContent = `${item.qty}x ${item.name} - €${(item.price * item.qty).toFixed(2)}`;
      orderDetailsContent.appendChild(p);
    });
    if(order.specialInstructions) {
      const sp = document.createElement('p');
      sp.textContent = `Speciale instructies: ${order.specialInstructions}`;
      sp.className = 'italic mt-2 text-gray-600';
      orderDetailsContent.appendChild(sp);
    }
    orderStatusSelect.value = order.status || 'pending';
    orderExtraText.value = order.extraText || '';
    orderDetailModal.classList.remove('hidden');
  }

  // CLOSE ORDER DETAIL MODAL
  async function closeOrderDetail() {
    orderDetailModal.classList.add('hidden');
    selectedOrderIndex = null;
  }

  // UPDATE ORDER STATUS & EXTRA TEXT
  async function updateOrder() {
    if (selectedOrderIndex === null) return;
    const order = orders[selectedOrderIndex];
    order.status = orderStatusSelect.value;
    order.extraText = orderExtraText.value.trim();
    await saveOrders();
    await fetchOrders();
  }

  // DELETE ORDER
  async function deleteOrder() {
    if (selectedOrderIndex === null) return;
    orders.splice(selectedOrderIndex, 1);
    await saveOrders();
    await fetchOrders();
    closeOrderDetail();
  }

  // SCREEN ACCOUNT LOGIN FLOW
  function openScreenLogin() {
    screenLoginModal.classList.remove('hidden');
  }
  function closeScreenLogin() {
    screenLoginModal.classList.add('hidden');
  }
  function screenLogin() {
    const user = screenUsernameInput.value.trim();
    const pass = screenPasswordInput.value.trim();
    if (user === 'OperatorScreen' && pass === '8008') {
      screenLoggedIn = true;
      closeScreenLogin();
      guestView.classList.add('hidden');
      operatorView.classList.add('hidden');
      keepOpenView.classList.add('hidden');
      screenView.classList.remove('hidden');
      fetchScreenOrders();
      startScreenPolling();
    } else {
      alert('Verkeerde gebruikersnaam of wachtwoord');
    }
  }
  function screenLogout() {
    screenLoggedIn = false;
    screenView.classList.add('hidden');
    guestView.classList.remove('hidden');
    stopScreenPolling();
  }

  // FETCH ORDERS FOR SCREEN ACCOUNT
  async function fetchScreenOrders() {
    try {
      const res = await fetch(`https://api.jsonbin.io/v3/b/${JSONBIN_ID}/latest`, {
        headers: { 'X-Master-Key': JSONBIN_APIKEY }
      });
      const data = await res.json();
      screenOrders = data.record.orders || [];
      renderScreenOrders();
    } catch (e) {
      console.error('Error fetching orders for screen:', e);
    }
  }

  // RENDER SCREEN ORDERS SPLIT BY STATUS
  function renderScreenOrders() {
    if (!screenLoggedIn) return;
    screenPendingOrdersDiv.innerHTML = '';
    screenReadyOrdersDiv.innerHTML = '';

    const pending = screenOrders.filter(o => o.status === 'pending');
    const ready = screenOrders.filter(o => o.status === 'ready');

    // Check nieuw klaar orders voor geluid
    if (ready.length > lastReadyCount) {
      playDoneSound();
    }
    lastReadyCount = ready.length;

    if (pending.length === 0) {
      screenPendingOrdersDiv.innerHTML = '<p class="text-gray-500 italic">Geen bestellingen in behandeling</p>';
    } else {
      pending.forEach((order, i) => {
        const div = document.createElement('div');
        div.className = 'p-3 bg-yellow-100 rounded shadow text-xl font-semibold';
        div.textContent = `#${i + 1} - ${order.time}`;
        screenPendingOrdersDiv.appendChild(div);
      });
    }

    if (ready.length === 0) {
      screenReadyOrdersDiv.innerHTML = '<p class="text-gray-500 italic">Geen bestellingen klaar</p>';
    } else {
      ready.forEach((order, i) => {
        const div = document.createElement('div');
        div.className = 'p-3 bg-green-100 rounded shadow text-xl font-semibold';
        div.textContent = `#${i + 1} - ${order.time}`;
        screenReadyOrdersDiv.appendChild(div);
      });
    }
  }

  // SPEEL GELUID
  function playDoneSound() {
    const audio = new Audio(soundUrl);
    audio.play().catch(e => console.warn('Sound play failed:', e));
  }

  // POLLING
  let pollingInterval;
  let screenPollingInterval;

  function startPolling() {
    pollingInterval = setInterval(fetchOrders, 5000);
  }
  function stopPolling() {
    clearInterval(pollingInterval);
  }
  function startScreenPolling() {
    screenPollingInterval = setInterval(fetchScreenOrders, 5000);
  }
  function stopScreenPolling() {
    clearInterval(screenPollingInterval);
  }

  // SETUP ITEM BUTTONS INIT
  setupItemButtons();

  // EVENT LISTENERS GASTEN
  cartBtn.addEventListener('click', openCartView);
  closeCartBtn.addEventListener('click', closeCartView);
  placeOrderBtn.addEventListener('click', placeOrder);

  popupAddMore.addEventListener('click', () => {
    closeItemPopup();
  });
  popupCheckout.addEventListener('click', () => {
    const qty = parseInt(popupQty.value, 10);
    if (isNaN(qty) || qty < 1 || qty > 50) return alert('Aantal moet tussen 1 en 50 zijn');
    addToCart(currentPopupItem, qty);
    closeItemPopup();
    openCartView();
  });

  // OPERATOR LOGIN EVENTS
  operatorLoginBtn.addEventListener('click', openOperatorLogin);
  operatorLoginCancel.addEventListener('click', closeOperatorLogin);
  operatorLoginSubmit.addEventListener('click', operatorLogin);
  operatorLogoutBtn.addEventListener('click', () => {
    operatorLogout();
    stopPolling();
  });

  // OPERATOR ORDER DETAIL EVENTS
  deleteOrderBtn.addEventListener('click', async () => {
    if (confirm('Weet je zeker dat je deze bestelling wilt verwijderen?')) {
      await deleteOrder();
    }
  });
  closeOrderDetailBtn.addEventListener('click', async () => {
    await updateOrder();
    closeOrderDetail();
  });
  orderStatusSelect.addEventListener('change', updateOrder);
  orderExtraText.addEventListener('input', updateOrder);

  // SCREEN LOGIN EVENTS
  screenLoginBtn.addEventListener('click', openScreenLogin);
  screenLoginCancel.addEventListener('click', closeScreenLogin);
  screenLoginSubmit.addEventListener('click', screenLogin);
  screenLogoutBtn.addEventListener('click', () => {
    screenLogout();
    stopScreenPolling();
  });

  // Start polling als operator ingelogd is
  setInterval(() => {
    if (operatorLoggedIn) fetchOrders();
  }, 5000);

  // Init fetch orders
  fetchOrders();

})();
</script>
</body>
</html>
