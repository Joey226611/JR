<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Joey's Restaurant Bestelsysteem</title>
<style>
  body {
    font-family: Arial, sans-serif; margin:0; background:#f9f9f9; color:#222;
  }
  header {
    background:#2c3e50; color:#fff; padding:10px 20px; display:flex; align-items:center; justify-content:center; position:relative;
  }
  header img {
    height:40px; position:absolute; left:20px; top:10px;
  }
  header h1 {
    margin:0; font-size:1.5rem;
  }
  #languageSelect {
    position:absolute; top:12px; right:20px; padding:5px;
    border-radius:5px; border:none;
  }
  #tabs {
    display:flex; justify-content:center; background:#34495e; 
  }
  #tabs button {
    flex:1; padding:15px 0; background:none; border:none; color:#ecf0f1; cursor:pointer; font-size:1.1rem; font-weight:bold;
    transition:background 0.3s;
  }
  #tabs button.active, #tabs button:hover {
    background:#2ecc71; color:#fff;
  }
  .tab-content {
    max-width:600px; margin:20px auto; display:none; background:#fff; border-radius:8px; padding:15px; box-shadow:0 3px 10px rgba(0,0,0,0.1);
  }
  .tab-content.active {
    display:block;
  }
  .menu-item {
    display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; padding:10px 12px; border:1px solid #ddd; border-radius:5px;
    cursor:pointer; transition:background 0.2s;
  }
  .menu-item:hover {
    background:#f0f9f0;
  }
  .menu-item span {
    font-weight:600; font-size:1.1rem;
  }
  #cartBtn {
    position:fixed; bottom:20px; right:20px; background:#e67e22; color:#fff; border:none; padding:15px 20px; border-radius:50px; font-size:1.4rem; cursor:pointer;
    box-shadow:0 4px 10px rgba(230,126,34,0.6);
    z-index:999;
  }
  /* Modals */
  .modal-backdrop {
    display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.6); z-index:1000; justify-content:center; align-items:center;
  }
  .modal-backdrop.active {
    display:flex;
  }
  .modal {
    background:#fff; border-radius:8px; max-width:400px; width:90%; padding:20px; position:relative; box-shadow:0 5px 15px rgba(0,0,0,0.3);
  }
  .modal h2 {
    margin-top:0; margin-bottom:15px; font-weight:700; font-size:1.3rem;
  }
  .modal label {
    display:block; margin-bottom:8px; font-weight:600;
  }
  .modal input[type=text], .modal input[type=password], .modal input[type=number], .modal textarea {
    width:100%; padding:8px; margin-bottom:15px; border:1px solid #ccc; border-radius:4px; font-size:1rem; resize:none;
  }
  .modal textarea {
    height:70px;
  }
  .modal button {
    background:#2ecc71; border:none; color:#fff; padding:10px 18px; font-size:1.1rem; border-radius:6px; cursor:pointer;
    transition:background 0.3s;
  }
  .modal button:hover {
    background:#27ae60;
  }
  .close-btn {
    position:absolute; top:10px; right:15px; background:none; border:none; font-size:1.5rem; cursor:pointer; color:#aaa;
    transition:color 0.3s;
  }
  .close-btn:hover {
    color:#444;
  }
  /* Cart list */
  #cartItems {
    max-height:250px; overflow-y:auto; margin-bottom:15px;
  }
  #cartItems div {
    display:flex; justify-content:space-between; margin-bottom:8px; font-size:1rem; padding-bottom:4px; border-bottom:1px solid #eee;
  }
  /* Order Status */
  .order-block {
    background:#fefefe; padding:10px; margin-bottom:15px; border-radius:7px; box-shadow:0 1px 4px rgba(0,0,0,0.08);
  }
  .order-header {
    font-weight:700; font-size:1.1rem; margin-bottom:5px; display:flex; justify-content:space-between; align-items:center;
  }
  .order-items p {
    margin:2px 0;
  }
  .status-pending {
    color:#f39c12; font-weight:700;
  }
  .status-ready {
    color:#27ae60; font-weight:700;
  }
  .status-inprogress {
    color:#2980b9; font-weight:700;
  }
  /* Operator & screen views */
  #operatorView, #screenView {
    max-width: 650px; margin: 30px auto; background: #fff; padding: 20px; border-radius: 10px; box-shadow:0 4px 12px rgba(0,0,0,0.1); display:none;
  }
  #operatorView.active, #screenView.active {
    display:block;
  }
  #operatorOrders div.order-item, #screenPendingOrders div.order-item, #screenReadyOrders div.order-item {
    border:1px solid #ddd; padding:10px; border-radius:6px; margin-bottom:10px; cursor:pointer;
  }
  #operatorOrders div.order-item:hover {
    background:#f9f9f9;
  }
  /* Buttons */
  button.btn {
    background:#2980b9; color:#fff; border:none; border-radius:5px; padding:8px 14px; cursor:pointer; font-weight:700; margin-left:10px;
  }
  button.btn:hover {
    background:#1c5980;
  }
  /* Responsive */
  @media (max-width: 480px) {
    #tabs button {
      font-size: 14px;
      padding: 10px 0;
    }
    #cartBtn {
      padding: 12px 16px;
      font-size: 1.2rem;
    }
  }
</style>
</head>
<body>

<header>
  <img src="RLogo.jpg" alt="Logo" />
  <h1>Joey's Restaurant</h1>
  <select id="languageSelect" aria-label="Taal kiezen">
    <option value="en">English</option>
    <option value="nl">Nederlands</option>
    <option value="de">Deutsch</option>
    <option value="pl">Polska</option>
    <option value="ru">–†—É—Å—Å–∫–∏–π</option>
    <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
    <option value="eg">ŸÖÿµÿ±Ÿä</option>
  </select>
  <button id="loginButton" style="position:absolute; right:20px; top:15px; padding:6px 10px; background:#27ae60; color:#fff; border:none; border-radius:4px; cursor:pointer;">Operator Login</button>
  <button id="screenLoginButton" style="position:absolute; right:140px; top:15px; padding:6px 10px; background:#3498db; color:#fff; border:none; border-radius:4px; cursor:pointer;">Scherm Login</button>
</header>

<div id="tabs">
  <button data-tab="drinks" class="active">Drinks</button>
  <button data-tab="fingerfood">Fingerfood</button>
  <button data-tab="desserts">Desserts</button>
  <button data-tab="menus">Menu</button>
</div>

<!-- Tab Contents -->
<section id="drinks" class="tab-content active">
  <div class="menu-item" data-name="Cola" data-price="2.00">Cola (‚Ç¨2.00) <button onclick="addToCart(event)">+</button></div>
  <div class="menu-item" data-name="Water" data-price="1.50">Water (‚Ç¨1.50) <button onclick="addToCart(event)">+</button></div>
</section>
<section id="fingerfood" class="tab-content">
  <div class="menu-item" data-name="Pringles Natural" data-price="0.20">Pringles Natural (‚Ç¨0.20 per chip) <button onclick="openAmountPopup(event)">+</button></div>
  <div class="menu-item" data-name="Pringles BBQ" data-price="0.25">Pringles BBQ (‚Ç¨0.25 per chip) <button onclick="openAmountPopup(event)">+</button></div>
</section>
<section id="desserts" class="tab-content">
  <div class="menu-item" data-name="Chocolate Cake" data-price="3.50">Chocolate Cake (‚Ç¨3.50) <button onclick="addToCart(event)">+</button></div>
  <div class="menu-item" data-name="Ice Cream" data-price="3.00">Ice Cream (‚Ç¨3.00) <button onclick="addToCart(event)">+</button></div>
</section>
<section id="menus" class="tab-content">
  <div class="menu-item" data-name="Burger Menu" data-price="8.00">Burger Menu (‚Ç¨8.00) <button onclick="addToCart(event)">+</button></div>
  <div class="menu-item" data-name="Veggie Menu" data-price="7.50">Veggie Menu (‚Ç¨7.50) <button onclick="addToCart(event)">+</button></div>
</section>

<!-- Winkelmand knop -->
<button id="cartBtn">üõí <span id="cartCount">0</span></button>

<!-- Winkelmand Modal -->
<div id="cartModal" class="modal-backdrop">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="cartModalTitle">
    <button class="close-btn" onclick="closeCart()">√ó</button>
    <h2 id="cartModalTitle">Jouw Bestelling</h2>
    <div id="cartItems"></div>
    <label for="orderNotes">Opmerkingen (bijv. peper en zout):</label>
    <textarea id="orderNotes" placeholder="Schrijf hier eventuele opmerkingen..."></textarea>
    <button onclick="placeOrder()">Bestelling plaatsen</button>
  </div>
</div>

<!-- Hoeveelheid popup -->
<div id="amountModal" class="modal-backdrop">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="amountModalTitle">
    <button class="close-btn" onclick="closeAmountPopup()">√ó</button>
    <h2 id="amountModalTitle">Kies aantal (max 50)</h2>
    <input type="number" id="amountInput" min="1" max="50" value="1" />
    <button onclick="confirmAmount()">Toevoegen</button>
  </div>
</div>

<!-- Keep Open scherm na bestellen -->
<div id="keepOpenScreen" class="modal-backdrop">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="keepOpenTitle">
    <h2 id="keepOpenTitle">Bedankt voor je bestelling!</h2>
    <p>Je bestelnummer is: <strong id="orderNumberDisplay"></strong></p>
    <p>Laat deze website open tot dat je bestelling klaar is.</p>
    <button onclick="closeKeepOpen()">Sluiten</button>
  </div>
</div>

<!-- Operator login modal -->
<div id="loginModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="loginModalTitle">
  <div class="modal">
    <button class="close-btn" onclick="closeLogin()">√ó</button>
    <h2 id="loginModalTitle">Operator Login</h2>
    <label for="loginUser">Gebruikersnaam</label>
    <input type="text" id="loginUser" autocomplete="username" />
    <label for="loginPass">Wachtwoord</label>
    <input type="password" id="loginPass" autocomplete="current-password" />
    <button onclick="operatorLogin()">Inloggen</button>
  </div>
</div>

<!-- Operator scherm view -->
<div id="operatorView">
  <h2>Operator Overzicht</h2>
  <button onclick="operatorLogout()" style="background:#e74c3c; color:#fff; border:none; padding:10px 15px; border-radius:6px; cursor:pointer;">Uitloggen</button>
  <div id="operatorOrders"></div>
</div>

<!-- Order detail modal voor operator -->
<div id="orderDetailModal" class="modal-backdrop">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="orderDetailTitle">
    <button class="close-btn" onclick="closeOrderDetail()">√ó</button>
    <h2 id="orderDetailTitle">Bestelling Details</h2>
    <div id="orderDetailContent"></div>
    <label for="orderStatusSelect">Status</label>
    <select id="orderStatusSelect">
      <option value="pending">In Behandeling</option>
      <option value="ready">Klaar</option>
      <option value="delayed">Kan langer duren</option>
    </select>
    <label for="extraText">Extra tekst (communicatie klant)</label>
    <textarea id="extraText" placeholder="Voeg hier extra tekst toe..."></textarea>
    <button onclick="updateOrder()">Opslaan</button>
    <button onclick="deleteOrder()" style="background:#e74c3c; margin-left:10px;">Verwijderen</button>
  </div>
</div>

<!-- Schermaccount login modal -->
<div id="screenLoginModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="screenLoginTitle">
  <div class="modal">
    <button class="close-btn" onclick="closeScreenLogin()">√ó</button>
    <h2 id="screenLoginTitle">Schermaccount Login</h2>
    <label for="screenLoginUser">Gebruikersnaam</label>
    <input type="text" id="screenLoginUser" autocomplete="username" />
    <label for="screenLoginPass">Wachtwoord</label>
    <input type="password" id="screenLoginPass" autocomplete="current-password" />
    <button onclick="screenLogin()">Inloggen</button>
  </div>
</div>

<!-- Schermaccount overzicht -->
<div id="screenView">
  <h2>Bestellingen Scherm</h2>
  <button onclick="screenLogout()" style="background:#e74c3c; color:#fff; border:none; padding:10px 15px; border-radius:6px; cursor:pointer;">Uitloggen</button>
  <h3>In Behandeling</h3>
  <div id="screenPendingOrders"></div>
  <h3>Klaar</h3>
  <div id="screenReadyOrders"></div>
</div>

<audio id="doneSound" src="Sounds/DoneSoundForScreen.mp3" preload="auto"></audio>

<script>
(() => {
  'use strict';

  // JSONBin configuratie
  const JSONBIN_ID = "688f6efe7b4b8670d8ac3f46";
  const JSONBIN_APIKEY = "$2a$10$XpZeyd.RhynC0Ie0VWma7uJPbMYdUAIHuG24Smc5V0C5LU5d11H5O";
  const JSONBIN_URL = `https://api.jsonbin.io/v3/b/${JSONBIN_ID}`;
  
  // DOM elementen
  const tabs = document.querySelectorAll("#tabs button");
  const tabContents = document.querySelectorAll(".tab-content");
  const cartBtn = document.getElementById("cartBtn");
  const cartModal = document.getElementById("cartModal");
  const cartItemsDiv = document.getElementById("cartItems");
  const orderNotes = document.getElementById("orderNotes");
  const placeOrderBtn = cartModal.querySelector("button");
  const amountModal = document.getElementById("amountModal");
  const amountInput = document.getElementById("amountInput");
  const keepOpenScreen = document.getElementById("keepOpenScreen");
  const orderNumberDisplay = document.getElementById("orderNumberDisplay");
  const loginButton = document.getElementById("loginButton");
  const loginModal = document.getElementById("loginModal");
  const loginUser = document.getElementById("loginUser");
  const loginPass = document.getElementById("loginPass");
  const operatorView = document.getElementById("operatorView");
  const operatorOrders = document.getElementById("operatorOrders");
  const orderDetailModal = document.getElementById("orderDetailModal");
  const orderDetailContent = document.getElementById("orderDetailContent");
  const orderStatusSelect = document.getElementById("orderStatusSelect");
  const extraTextArea = document.getElementById("extraText");
  const screenLoginButton = document.getElementById("screenLoginButton");
  const screenLoginModal = document.getElementById("screenLoginModal");
  const screenLoginUser = document.getElementById("screenLoginUser");
  const screenLoginPass = document.getElementById("screenLoginPass");
  const screenView = document.getElementById("screenView");
  const screenPendingOrders = document.getElementById("screenPendingOrders");
  const screenReadyOrders = document.getElementById("screenReadyOrders");
  const doneSound = document.getElementById("doneSound");
  const languageSelect = document.getElementById("languageSelect");
  
  // State
  let currentTab = "drinks";
  let cart = [];
  let currentAmountItem = null;
  let ordersData = { orders: [], counter: 0 };
  let loggedInOperator = false;
  let loggedInScreen = false;
  let currentOrderDetail = null;
  let pollingInterval = null;
  let lang = localStorage.getItem('restaurantLang') || 'en';

  // Teksten per taal (voor basic demo, kan uitgebreid)
  const texts = {
    en: {
      orderPlaced: "Thank you! Your order number is:",
      keepOpen: "Please keep this website open until your order is ready.",
      operatorLogin: "Operator Login",
      operatorLogout: "Logout",
      screenLogin: "Screen Login",
      orderStatus: {
        pending: "In Progress",
        ready: "Ready",
        delayed: "Might take longer"
      },
      placeOrder: "Place Order",
      orderNotes: "Order Notes",
      addToCart: "Add to cart",
      quantity: "Quantity",
      confirm: "Confirm",
      cancel: "Cancel",
      delete: "Delete",
      extraText: "Extra text (communication with customer)"
    },
    nl: {
      orderPlaced: "Bedankt! Je bestelnummer is:",
      keepOpen: "Laat deze website open tot dat je bestelling klaar is.",
      operatorLogin: "Operator Inloggen",
      operatorLogout: "Uitloggen",
      screenLogin: "Scherm Inloggen",
      orderStatus: {
        pending: "In Behandeling",
        ready: "Klaar",
        delayed: "Kan langer duren"
      },
      placeOrder: "Bestelling plaatsen",
      orderNotes: "Opmerkingen",
      addToCart: "Toevoegen",
      quantity: "Aantal",
      confirm: "Bevestigen",
      cancel: "Annuleren",
      delete: "Verwijderen",
      extraText: "Extra tekst (communicatie klant)"
    }
    // Je kan hier Duits, Polska, Russisch, Arabisch, Egyptisch etc toevoegen als je wilt
  };

  function t(key) {
    // eenvoudige vertaling functie met support voor nested keys (dot notation)
    const parts = key.split('.');
    let cur = texts[lang] || texts['en'];
    for (const p of parts) {
      if(cur[p]) cur = cur[p];
      else return key; // fallback key
    }
    return cur;
  }

  // Initialiseer taal
  languageSelect.value = lang;

  languageSelect.addEventListener('change', () => {
    lang = languageSelect.value;
    localStorage.setItem('restaurantLang', lang);
    location.reload(); // simpel reload om teksten te updaten, kan mooier later
  });

  // Tab switching
  tabs.forEach(btn => {
    btn.addEventListener('click', () => {
      if(loggedInOperator || loggedInScreen) return; // tabs blokkeren voor operator/screen
      tabs.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      currentTab = btn.dataset.tab;
      tabContents.forEach(tc => {
        if(tc.id === currentTab) tc.classList.add('active');
        else tc.classList.remove('active');
      });
    });
  });

  // CART MANAGEMENT
  function addToCart(event) {
    event.stopPropagation();
    const itemDiv = event.target.closest('.menu-item');
    if(!itemDiv) return;
    const name = itemDiv.dataset.name;
    const price = parseFloat(itemDiv.dataset.price);
    // Voor fingerfood: open amount popup, anders add 1 direct
    if(name.toLowerCase().includes('pringles')) {
      openAmountPopup(event);
      return;
    }
    addItemToCart(name, price, 1);
  }

  function openAmountPopup(event) {
    event.stopPropagation();
    const itemDiv = event.target.closest('.menu-item');
    if(!itemDiv) return;
    const name = itemDiv.dataset.name;
    const price = parseFloat(itemDiv.dataset.price);
    currentAmountItem = { name, price };
    amountInput.value = 1;
    amountModal.classList.add('active');
  }

  function closeAmountPopup() {
    amountModal.classList.remove('active');
    currentAmountItem = null;
  }

  function confirmAmount() {
    let amount = parseInt(amountInput.value);
    if(isNaN(amount) || amount < 1) amount = 1;
    if(amount > 50) amount = 50;
    addItemToCart(currentAmountItem.name, currentAmountItem.price, amount);
    closeAmountPopup();
  }

  function addItemToCart(name, price, amount) {
    // Check of item al in cart zit, zo ja + amount optellen
    const existing = cart.find(i => i.name === name);
    if(existing) existing.amount += amount;
    else cart.push({name, price, amount});
    updateCartCount();
  }

  function updateCartCount() {
    const count = cart.reduce((acc, i) => acc + i.amount, 0);
    document.getElementById('cartCount').textContent = count;
  }

  // Cart modal open/close
  cartBtn.addEventListener('click', () => {
    if(cart.length === 0) {
      alert('Je winkelmandje is leeg.');
      return;
    }
    renderCart();
    cartModal.classList.add('active');
  });

  function closeCart() {
    cartModal.classList.remove('active');
  }

  function renderCart() {
    cartItemsDiv.innerHTML = '';
    cart.forEach((item, i) => {
      const div = document.createElement('div');
      div.textContent = `${item.name} x${item.amount} - ‚Ç¨${(item.price*item.amount).toFixed(2)}`;
      cartItemsDiv.appendChild(div);
    });
    orderNotes.value = '';
  }

  // Plaats bestelling
  async function placeOrder() {
    if(cart.length === 0) {
      alert('Je winkelmandje is leeg.');
      return;
    }
    const notes = orderNotes.value.trim();

    // haal orders en counter op van JSONBin
    await loadOrdersData();

    // tel counter op
    ordersData.counter++;
    const orderNumber = ordersData.counter;

    // Maak order object
    const order = {
      id: orderNumber,
      items: [...cart],
      notes,
      status: "pending",
      extraText: "",
      time: new Date().toISOString()
    };
    ordersData.orders.push(order);

    // Update JSONBin
    await saveOrdersData();

    // Leeg winkelmandje
    cart = [];
    updateCartCount();
    closeCart();

    // Toon Keep Open scherm
    orderNumberDisplay.textContent = orderNumber;
    keepOpenScreen.classList.add('active');

    // Start polling als gast voor updates (niet in gebruik, optioneel)
    startPolling();

    // Sla laatste order ID lokaal op om te checken
    localStorage.setItem('lastOrderID', orderNumber);
  }

  function closeKeepOpen() {
    keepOpenScreen.classList.remove('active');
  }

  // OPERATOR LOGIN / VIEW
  loginButton.addEventListener('click', () => {
    if(loggedInOperator) {
      operatorLogout();
    } else {
      loginModal.classList.add('active');
    }
  });

  function closeLogin() {
    loginModal.classList.remove('active');
    loginUser.value = '';
    loginPass.value = '';
  }

  async function operatorLogin() {
    const user = loginUser.value.trim();
    const pass = loginPass.value.trim();
    if(user === "Operator" && pass === "8008") {
      loggedInOperator = true;
      closeLogin();
      showOperatorView();
      startPolling();
    } else {
      alert("Foutieve gebruikersnaam of wachtwoord.");
    }
  }

  function operatorLogout() {
    loggedInOperator = false;
    operatorView.classList.remove('active');
    loginButton.textContent = "Operator Login";
    clearPolling();
    location.reload();
  }

  function showOperatorView() {
    operatorView.classList.add('active');
    loginButton.textContent = "Uitloggen";
    // Verberg tabs voor operator
    document.getElementById('tabs').style.display = 'none';
    tabContents.forEach(c => c.style.display = 'none');
    cartBtn.style.display = 'none';
    renderOperatorOrders();
  }

  // ORDER DETAIL MODAL OPERATOR
  function closeOrderDetail() {
    orderDetailModal.classList.remove('active');
    currentOrderDetail = null;
  }

  // Bestelling bekijken bij operator
  function openOrderDetail(id) {
    currentOrderDetail = ordersData.orders.find(o => o.id === id);
    if(!currentOrderDetail) return alert("Bestelling niet gevonden.");
    let html = `<p><strong>Bestelnummer:</strong> #${currentOrderDetail.id}</p><p><strong>Tijd:</strong> ${new Date(currentOrderDetail.time).toLocaleString()}</p>`;
    html += "<p><strong>Items:</strong></p><ul>";
    currentOrderDetail.items.forEach(i => {
      html += `<li>${i.name} x${i.amount} - ‚Ç¨${(i.price*i.amount).toFixed(2)}</li>`;
    });
    html += "</ul>";
    html += `<p><strong>Opmerkingen:</strong> ${currentOrderDetail.notes || "-"}</p>`;
    html += `<p><strong>Extra tekst:</strong> ${currentOrderDetail.extraText || "-"}</p>`;
    orderDetailContent.innerHTML = html;
    orderStatusSelect.value = currentOrderDetail.status || "pending";
    extraTextArea.value = currentOrderDetail.extraText || "";
    orderDetailModal.classList.add('active');
  }

  async function updateOrder() {
    if(!currentOrderDetail) return;
    currentOrderDetail.status = orderStatusSelect.value;
    currentOrderDetail.extraText = extraTextArea.value.trim();
    await saveOrdersData();
    renderOperatorOrders();
    closeOrderDetail();
  }

  async function deleteOrder() {
    if(!currentOrderDetail) return;
    if(!confirm("Weet je zeker dat je deze bestelling wilt verwijderen?")) return;
    // Bestelling verwijderen, teller niet resetten
    ordersData.orders = ordersData.orders.filter(o => o.id !== currentOrderDetail.id);
    await saveOrdersData();
    renderOperatorOrders();
    closeOrderDetail();
  }

  function renderOperatorOrders() {
    operatorOrders.innerHTML = "";
    if(!ordersData.orders.length) {
      operatorOrders.textContent = "Geen bestellingen.";
      return;
    }
    ordersData.orders.forEach(order => {
      const div = document.createElement('div');
      div.className = "order-item";
      div.textContent = `#${order.id} - ${order.status.toUpperCase()} - ${new Date(order.time).toLocaleTimeString()}`;
      div.onclick = () => openOrderDetail(order.id);
      operatorOrders.appendChild(div);
    });
  }

  // SCREEN LOGIN & VIEW
  screenLoginButton.addEventListener('click', () => {
    if(loggedInScreen) {
      screenLogout();
    } else {
      screenLoginModal.classList.add('active');
    }
  });

  function closeScreenLogin() {
    screenLoginModal.classList.remove('active');
    screenLoginUser.value = '';
    screenLoginPass.value = '';
  }

  async function screenLogin() {
    const user = screenLoginUser.value.trim();
    const pass = screenLoginPass.value.trim();
    if(user === "OperatorScreen" && pass === "8008") {
      loggedInScreen = true;
      closeScreenLogin();
      showScreenView();
      startPolling();
    } else {
      alert("Foutieve gebruikersnaam of wachtwoord.");
    }
  }

  function screenLogout() {
    loggedInScreen = false;
    screenView.classList.remove('active');
    screenLoginButton.textContent = "Scherm Login";
    clearPolling();
    location.reload();
  }

  function showScreenView() {
    screenView.classList.add('active');
    screenLoginButton.textContent = "Uitloggen";
    // Hide tabs and cart for screen account
    document.getElementById('tabs').style.display = 'none';
    tabContents.forEach(c => c.style.display = 'none');
    cartBtn.style.display = 'none';
    operatorView.classList.remove('active');
  }

  // POLLING FUNCTION
  function startPolling() {
    if(pollingInterval) clearInterval(pollingInterval);
    pollingInterval = setInterval(loadOrdersData, 3000);
    loadOrdersData();
  }
  function clearPolling() {
    if(pollingInterval) clearInterval(pollingInterval);
  }

  // LOAD ORDERS DATA VAN JSONBIN
  async function loadOrdersData() {
    try {
      const res = await fetch(JSONBIN_URL + "/latest", {
        headers: { "X-Master-Key": JSONBIN_APIKEY }
      });
      if(!res.ok) throw new Error("Failed to fetch orders");
      const json = await res.json();
      const newData = json.record || { orders: [], counter: 0 };

      // Check of er nieuwe "ready" orders zijn gekomen voor screen geluid
      if(loggedInScreen) {
        const oldReady = ordersData.orders.filter(o => o.status === 'ready').map(o => o.id);
        const newReady = (newData.orders || []).filter(o => o.status === 'ready').map(o => o.id);
        newReady.forEach(id => {
          if(!oldReady.includes(id)) doneSound.play();
        });
      }

      ordersData = newData;

      if(loggedInOperator) renderOperatorOrders();
      if(loggedInScreen) renderScreenOrders();

      // Voor gast klant (Keep Open) kan je hier checken status als je wil (optioneel)
    } catch(e) {
      console.error(e);
    }
  }

  // SAVE ORDERS DATA NAAR JSONBIN
  async function saveOrdersData() {
    try {
      const res = await fetch(JSONBIN_URL, {
        method: "PUT",
        headers: {
          "Content-Type": "application/json",
          "X-Master-Key": JSONBIN_APIKEY,
          "X-Bin-Versioning": "false"
        },
        body: JSON.stringify(ordersData)
      });
      if(!res.ok) throw new Error("Failed to save orders");
    } catch(e) {
      console.error(e);
      alert("Er ging iets mis bij het opslaan van de bestelling.");
    }
  }

  // RENDER SCREEN ORDERS
  function renderScreenOrders() {
    screenPendingOrders.innerHTML = '';
    screenReadyOrders.innerHTML = '';
    ordersData.orders.forEach(order => {
      const div = document.createElement('div');
      div.className = 'order-item';
      div.textContent = `#${order.id}`;
      if(order.status === 'ready') {
        screenReadyOrders.appendChild(div);
      } else {
        screenPendingOrders.appendChild(div);
      }
    });
  }

  // TAB INIT
  function init() {
    updateCartCount();
    loadOrdersData();
  }
  init();

  // Return public functions for buttons
  window.addToCart = addToCart;
  window.openAmountPopup = openAmountPopup;
  window.closeAmountPopup = closeAmountPopup;
  window.confirmAmount = confirmAmount;
  window.openCart = () => cartBtn.click();
  window.closeCart = closeCart;
  window.placeOrder = placeOrder;
  window.closeKeepOpen = closeKeepOpen;
  window.closeLogin = closeLogin;
  window.operatorLogin = operatorLogin;
  window.operatorLogout = operatorLogout;
  window.openOrderDetail = openOrderDetail;
  window.closeOrderDetail = closeOrderDetail;
  window.updateOrder = updateOrder;
  window.deleteOrder = deleteOrder;
  window.closeScreenLogin = closeScreenLogin;
  window.screenLogin = screenLogin;
  window.screenLogout = screenLogout;

})();
</script>

</body>
</html>
