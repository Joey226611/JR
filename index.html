<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Joey's Mc-style Restaurant</title>
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #fff8f0;
    }
    header {
      background-color: #da291c;
      color: white;
      padding: 10px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    header img {
      height: 40px;
    }
    #language-select {
      background-color: white;
      color: black;
      border: none;
      font-size: 1rem;
      padding: 4px;
    }
    .screen {
      display: none;
      padding: 20px;
    }
    .visible {
      display: block;
    }
    .login-page {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 80px;
    }
    .login-box {
      background: #fff;
      padding: 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
      border-radius: 8px;
    }
    .login-box input {
      margin-bottom: 10px;
      padding: 10px;
      width: 100%;
    }
    .login-box button {
      padding: 10px;
      background: #da291c;
      color: white;
      border: none;
      width: 100%;
      cursor: pointer;
    }
    #homeIcon {
      position: fixed;
      bottom: 15px;
      left: 15px;
      background: white;
      border: 2px solid #da291c;
      border-radius: 50%;
      font-size: 20px;
      width: 50px;
      height: 50px;
      text-align: center;
      line-height: 45px;
      cursor: pointer;
      z-index: 999;
      display: none;
    }
  </style>
</head>
<body>
  <header>
    <img src="RLogo.jpg" alt="Logo">
    <select id="language-select">
      <option value="en">English</option>
      <option value="nl">Nederlands</option>
      <option value="de">Deutsch</option>
      <option value="pl">Polska</option>
      <option value="ru">–†—É—Å—Å–∫–∏–π</option>
      <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
      <option value="eg">ŸÖÿµÿ±Ÿäÿ©</option>
    </select>
  </header>

  <div id="loginScreen" class="screen visible">
    <div class="login-page">
      <div class="login-box">
        <h2>Login</h2>
        <select id="accountType">
          <option value="Operator">Operator</option>
          <option value="OperatorScreen">Display Screen</option>
        </select>
        <input type="text" id="username" placeholder="Username">
        <input type="password" id="password" placeholder="Password">
        <button onclick="handleLogin()">Login</button>
      </div>
    </div>
  </div>
  <div id="customerScreen" class="screen">
    <h2>Selecteer je producten</h2>
    <div id="tabsContainer"></div>
    <div id="productsContainer"></div>

    <h3>üõí Winkelmandje</h3>
    <div id="cartItems"></div>
    <textarea id="customerNote" placeholder="Opmerking..."></textarea>
    <button onclick="placeOrder()">Bestellen</button>
  </div>

  <div id="homeIcon" onclick="goHome()">üè†</div>

  <script>
    // Configs
    const productBinId = '689091d47b4b8670d8acd414';
    const productApiKey = '$2a$10$XpZeyd.RhynC0Ie0VWma7uJPbMYdUAIHuG24Smc5V0C5LU5d11H5O';

    const orderBinId = '688f6efe7b4b8670d8ac3f46';
    const orderApiKey = '$2a$10$XpZeyd.RhynC0Ie0VWma7uJPbMYdUAIHuG24Smc5V0C5LU5d11H5O';

    let selectedTab = '';
    let cart = [];
    let tabs = [];

    function loadProducts() {
      fetch(`https://api.jsonbin.io/v3/b/${productBinId}/latest`, {
        headers: { 'X-Master-Key': productApiKey }
      })
      .then(res => res.json())
      .then(data => {
        const products = data.record;
        tabs = Object.keys(products);
        showTabs(tabs);
        showProducts(tabs[0], products[tabs[0]]);
      });
    }

    function showTabs(tabNames) {
      const tabDiv = document.getElementById('tabsContainer');
      tabDiv.innerHTML = '';
      tabNames.forEach(tab => {
        const btn = document.createElement('button');
        btn.textContent = tab;
        btn.onclick = () => showProducts(tab);
        tabDiv.appendChild(btn);
      });
    }

    function showProducts(tab, list = null) {
      selectedTab = tab;
      const container = document.getElementById('productsContainer');
      container.innerHTML = '';
      fetch(`https://api.jsonbin.io/v3/b/${productBinId}/latest`, {
        headers: { 'X-Master-Key': productApiKey }
      })
      .then(res => res.json())
      .then(data => {
        const items = data.record[tab] || [];
        items.forEach(p => {
          if (p.status === 'uitverkocht') return;
          const box = document.createElement('div');
          box.style.border = '1px solid #ccc';
          box.style.margin = '5px';
          box.style.padding = '10px';
          box.style.borderRadius = '8px';
          box.innerHTML = `
            <strong>${p.naam}</strong><br>
            Prijs: ‚Ç¨${p.prijs}<br>
            ${p.foto ? `<img src="${p.foto}" width="80"><br>` : ''}
            <button onclick='addToCart(${JSON.stringify(p)})'>Toevoegen</button>
          `;
          container.appendChild(box);
        });
      });
    }

    function addToCart(product) {
      cart.push(product);
      updateCart();
    }

    function updateCart() {
      const div = document.getElementById('cartItems');
      div.innerHTML = '';
      cart.forEach((item, i) => {
        const row = document.createElement('div');
        row.innerHTML = `${item.naam} (‚Ç¨${item.prijs}) <button onclick="removeFromCart(${i})">X</button>`;
        div.appendChild(row);
      });
    }

    function removeFromCart(i) {
      cart.splice(i, 1);
      updateCart();
    }

    function placeOrder() {
      if (cart.length === 0) return alert('Je hebt niks besteld!');
      const order = {
        timestamp: new Date().toISOString(),
        status: 'In behandeling',
        items: cart,
        note: document.getElementById('customerNote').value || '',
        id: 'order-' + Date.now()
      };
      fetch(`https://api.jsonbin.io/v3/b/${orderBinId}`, {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json',
          'X-Master-Key': orderApiKey
        },
        body: JSON.stringify(order)
      })
      .then(() => {
        alert('Bestelling geplaatst!');
        cart = [];
        updateCart();
        document.getElementById('customerNote').value = '';
      });
    }
  </script>
  <!-- Operator & Display Login -->
  <div id="secretLogin" style="display:none;">
    <h3>üîí Geheime Login</h3>
    <input id="hiddenUser" placeholder="Gebruikersnaam"><br>
    <input id="hiddenPass" type="password" placeholder="Wachtwoord"><br>
    <button onclick="checkHiddenLogin()">Inloggen</button>
  </div>

  <!-- Operator Panel -->
  <div id="operatorScreen" class="screen">
    <h2>Operatorpaneel</h2>
    <div id="ordersOperator"></div>
  </div>

  <!-- Display Screen -->
  <div id="displayScreen" class="screen">
    <h2>üñ•Ô∏è Display Scherm</h2>
    <h3>In Behandeling</h3>
    <div id="inProgressList" style="color: brown;"></div>
    <h3>Klaar</h3>
    <div id="readyList" style="color: green;"></div>
    <audio id="doneSound">
      <source src="JR/Sounds/DoneSoundForScreen.mp3" type="audio/mpeg">
    </audio>
  </div>

  <script>
    // Activate CTRL+SHIFT+Z shortcut
    document.addEventListener('keydown', e => {
      if (e.ctrlKey && e.shiftKey && e.key === 'Z') {
        document.getElementById('secretLogin').style.display = 'block';
      }
    });

    function checkHiddenLogin() {
      const user = document.getElementById('hiddenUser').value;
      const pass = document.getElementById('hiddenPass').value;
      if (user === 'Operator' && pass === '8008') {
        showScreen('operatorScreen');
      } else if (user === 'OperatorScreen' && pass === '8008') {
        showScreen('displayScreen');
      } else {
        alert('Onjuiste gegevens!');
      }
    }

    function showScreen(id) {
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      document.getElementById(id).classList.add('active');
    }

    function goHome() {
      showScreen('customerScreen');
    }

    function fetchOrdersAndUpdateScreens() {
      fetch(`https://api.jsonbin.io/v3/b/${orderBinId}/latest`, {
        headers: { 'X-Master-Key': orderApiKey }
      })
      .then(res => res.json())
      .then(data => {
        const order = data.record;
        if (!order || !order.items) return;

        // Operator
        const opDiv = document.getElementById('ordersOperator');
        if (opDiv) {
          opDiv.innerHTML = `
            <strong>ID:</strong> ${order.id}<br>
            <strong>Status:</strong> 
              <select onchange="changeOrderStatus(this.value)">
                <option ${order.status === 'In behandeling' ? 'selected' : ''}>In behandeling</option>
                <option ${order.status === 'Klaar' ? 'selected' : ''}>Klaar</option>
              </select><br>
            <strong>Opmerking:</strong> ${order.note || '(geen)'}<br>
            <strong>Tijd:</strong> ${new Date(order.timestamp).toLocaleTimeString()}<br>
            <strong>Items:</strong>
            <ul>${order.items.map(i => `<li>${i.naam} - ‚Ç¨${i.prijs}</li>`).join('')}</ul>
            <button onclick="removeOrder()">Verwijder bestelling</button>
          `;
        }

        // Display
        if (document.getElementById('displayScreen').classList.contains('active')) {
          const inProg = document.getElementById('inProgressList');
          const ready = document.getElementById('readyList');
          inProg.innerHTML = '';
          ready.innerHTML = '';

          const div = document.createElement('div');
          div.textContent = order.id;

          if (order.status === 'In behandeling') {
            inProg.appendChild(div);
          } else if (order.status === 'Klaar') {
            ready.appendChild(div);
            playDoneSound();
          }
        }
      });
    }

    function changeOrderStatus(newStatus) {
      fetch(`https://api.jsonbin.io/v3/b/${orderBinId}/latest`, {
        headers: { 'X-Master-Key': orderApiKey }
      })
      .then(res => res.json())
      .then(data => {
        const order = data.record;
        order.status = newStatus;
        fetch(`https://api.jsonbin.io/v3/b/${orderBinId}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
            'X-Master-Key': orderApiKey
          },
          body: JSON.stringify(order)
        });
      });
    }

    function removeOrder() {
      fetch(`https://api.jsonbin.io/v3/b/${orderBinId}`, {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json',
          'X-Master-Key': orderApiKey
        },
        body: JSON.stringify({})
      }).then(() => alert('Bestelling verwijderd.'));
    }

    function playDoneSound() {
      const audio = document.getElementById('doneSound');
      if (audio) audio.play();
    }

    setInterval(fetchOrdersAndUpdateScreens, 3000); // Real-time updates elke 3 sec
    loadProducts(); // Laad direct bij start
  </script>
<!-- Product Beheer Paneel -->
<div id="productManager" class="screen">
  <h2>üõ†Ô∏è Productbeheer</h2>
  <select id="productTabSelect" onchange="loadProductList()"></select>
  <div id="productList"></div>
  <hr>
  <h3>‚ûï Nieuw product toevoegen</h3>
  <input id="newProdName" placeholder="Naam"><br>
  <input id="newProdPrice" type="number" placeholder="Prijs"><br>
  <input id="newProdImage" placeholder="Afbeelding URL"><br>
  <label><input type="checkbox" id="newProdAvailable" checked> Beschikbaar</label><br>
  <button onclick="addProduct()">Voeg toe</button>
</div>
<script>
const productBinId = '689091d47b4b8670d8acd414';
const productApiKey = '$2a$10$XpZeyd.RhynC0Ie0VWma7uJPbMYdUAIHuG24Smc5V0C5LU5d11H5O';

let productData = {};

function openProductManager() {
  showScreen('productManager');
  fetch(`https://api.jsonbin.io/v3/b/${productBinId}/latest`, {
    headers: { 'X-Master-Key': productApiKey }
  })
  .then(res => res.json())
  .then(data => {
    productData = data.record;
    updateTabSelector();
    loadProductList();
  });
}

function updateTabSelector() {
  const tabs = Object.keys(productData);
  const select = document.getElementById('productTabSelect');
  select.innerHTML = tabs.map(tab => `<option>${tab}</option>`).join('');
}

function loadProductList() {
  const tab = document.getElementById('productTabSelect').value;
  const list = document.getElementById('productList');
  list.innerHTML = productData[tab].map((prod, i) => `
    <div style="border:1px solid #ccc;padding:8px;margin:8px;">
      <input value="${prod.naam}" onchange="editProduct('${tab}',${i},'naam',this.value)">
      <input type="number" value="${prod.prijs}" onchange="editProduct('${tab}',${i},'prijs',this.value)">
      <input value="${prod.foto}" onchange="editProduct('${tab}',${i},'foto',this.value)">
      <label><input type="checkbox" ${prod.beschikbaar ? 'checked' : ''} onchange="editProduct('${tab}',${i},'beschikbaar',this.checked)"> Beschikbaar</label>
      <button onclick="deleteProduct('${tab}',${i})">üóëÔ∏è</button>
    </div>
  `).join('');
}

function editProduct(tab, index, key, value) {
  productData[tab][index][key] = key === 'prijs' ? parseFloat(value) : value;
  if (key === 'beschikbaar') productData[tab][index][key] = value;
  saveProducts();
}

function deleteProduct(tab, index) {
  productData[tab].splice(index, 1);
  saveProducts();
  loadProductList();
}

function addProduct() {
  const tab = document.getElementById('productTabSelect').value;
  const naam = document.getElementById('newProdName').value;
  const prijs = parseFloat(document.getElementById('newProdPrice').value);
  const foto = document.getElementById('newProdImage').value;
  const beschikbaar = document.getElementById('newProdAvailable').checked;
  if (!naam || isNaN(prijs)) return alert("Naam en prijs zijn verplicht!");
  productData[tab].push({ naam, prijs, beschikbaar, foto });
  saveProducts();
  loadProductList();
  document.getElementById('newProdName').value = '';
  document.getElementById('newProdPrice').value = '';
  document.getElementById('newProdImage').value = '';
  document.getElementById('newProdAvailable').checked = true;
}

function saveProducts() {
  fetch(`https://api.jsonbin.io/v3/b/${productBinId}`, {
    method: 'PUT',
    headers: {
      'Content-Type': 'application/json',
      'X-Master-Key': productApiKey
    },
    body: JSON.stringify(productData)
  });
}
</script>
