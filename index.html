<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Joey's Restaurant Bestelsysteem</title>
<style>
  /* Reset + basis */
  * {
    box-sizing: border-box;
  }
  body {
    margin:0; padding:0;
    font-family: Arial, sans-serif;
    background: #f9f9f9;
    color: #222;
  }
  header {
    background: #333;
    color: white;
    padding: 10px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  header h1 {
    margin: 0;
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 1.5em;
  }
  /* Home icon */
  #homeIcon {
    cursor: pointer;
    width: 24px;
    height: 24px;
    fill: white;
    transition: fill 0.3s;
  }
  #homeIcon:hover {
    fill: #5c8a8a;
  }
  nav a {
    color: #ccc;
    margin-left: 20px;
    text-decoration: none;
    font-weight: bold;
  }
  nav a:hover {
    color: white;
  }

  /* Login pages */
  #loginPages {
    min-height: 80vh;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 40px;
  }
  .login-page {
    background: white;
    padding: 30px;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgb(0 0 0 / 0.2);
    width: 320px;
  }
  .login-page h2 {
    margin-top: 0;
    margin-bottom: 20px;
    text-align: center;
  }
  .login-page label {
    display: block;
    margin-top: 15px;
  }
  .login-page input[type=text],
  .login-page input[type=password] {
    width: 100%;
    padding: 8px;
    margin-top: 5px;
    border-radius: 5px;
    border: 1px solid #ccc;
    font-size: 16px;
  }
  .login-page button {
    margin-top: 25px;
    width: 100%;
    padding: 12px 0;
    font-size: 18px;
    font-weight: bold;
    border: none;
    background-color: #5c8a8a;
    color: white;
    border-radius: 6px;
    cursor: pointer;
    transition: background-color 0.3s;
  }
  .login-page button:hover {
    background-color: #3e5c5c;
  }

  /* Main bestel scherm */
  #mainView {
    padding: 20px;
    display: none;
  }
  #tabs {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
  }
  #tabs button {
    background: #ddd;
    border: none;
    padding: 10px 20px;
    border-radius: 5px 5px 0 0;
    cursor: pointer;
    font-weight: bold;
  }
  #tabs button.active, #tabs button:hover {
    background: #5c8a8a;
    color: white;
  }
  .tab-content {
    display: none;
    background: white;
    padding: 20px;
    border-radius: 0 5px 5px 5px;
    box-shadow: 0 2px 5px rgb(0 0 0 / 0.1);
  }
  .tab-content.active {
    display: block;
  }
  .menu-item {
    padding: 10px;
    border-bottom: 1px solid #eee;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .menu-item button {
    padding: 6px 12px;
    font-size: 14px;
    border: none;
    border-radius: 4px;
    background: #5c8a8a;
    color: white;
    cursor: pointer;
  }
  .menu-item button:hover {
    background: #3e5c5c;
  }

  /* Winkelmandje knop */
  #cartBtn {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #5c8a8a;
    color: white;
    padding: 15px 20px;
    border-radius: 50px;
    font-weight: bold;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 10px;
    box-shadow: 0 4px 8px rgb(0 0 0 / 0.2);
    user-select: none;
    z-index: 10;
  }
  #cartCount {
    background: #a85c5c;
    border-radius: 50%;
    padding: 3px 8px;
    font-size: 14px;
  }

  /* Modal styling */
  .modal, #keepOpenScreen, #orderDetailModal {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.5);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 100;
  }
  .modal.active, #keepOpenScreen.active, #orderDetailModal.active {
    display: flex;
  }
  .modal-content, #keepOpenScreen > div, #orderDetailModal > div {
    background: white;
    padding: 20px;
    border-radius: 8px;
    max-width: 400px;
    width: 90%;
    box-sizing: border-box;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  }
  textarea {
    width: 100%;
    box-sizing: border-box;
    margin-top: 5px;
    padding: 8px;
    border-radius: 4px;
    border: 1px solid #ccc;
    resize: vertical;
    font-size: 14px;
  }
  label {
    display: block;
    margin-top: 10px;
    font-weight: bold;
  }
  select {
    width: 100%;
    padding: 8px;
    margin-top: 5px;
    border-radius: 4px;
    border: 1px solid #ccc;
  }

  /* Operator orders lijst */
  #operatorOrders {
    max-height: 400px;
    overflow-y: auto;
    border: 1px solid #ccc;
    padding: 10px;
    border-radius: 5px;
    background: #f1f1f1;
  }
  .order-item {
    background: white;
    margin-bottom: 8px;
    padding: 10px;
    border-radius: 5px;
    cursor: pointer;
    box-shadow: 0 1px 3px rgb(0 0 0 / 0.1);
  }
  .order-item:focus, .order-item:hover {
    outline: none;
    background: #d4e7e7;
  }

  /* Bestelling detail modal */
  #orderDetailContent {
    white-space: pre-wrap;
    margin-top: 10px;
    font-family: monospace;
    background: #eee;
    padding: 10px;
    border-radius: 4px;
    max-height: 150px;
    overflow-y: auto;
  }

  /* Screen view */
  #screenView {
    display: none;
    padding: 20px;
    gap: 40px;
    background: #222;
    color: white;
    height: 100vh;
    box-sizing: border-box;
    overflow-y: auto;
    flex-wrap: nowrap;
    flex-direction: row;
    justify-content: flex-start;
    align-items: flex-start;
  }
  #screenView > div {
    flex: 1;
    min-width: 150px;
  }
  #screenView h3 {
    margin-top: 0;
    border-bottom: 2px solid white;
    padding-bottom: 10px;
    font-size: 1.5em;
    font-weight: bold;
    text-align: center;
  }
  .order-item-screen {
    padding: 20px;
    margin-bottom: 10px;
    border-radius: 5px;
    font-size: 4em;
    font-weight: bold;
    text-align: center;
    user-select: none;
    white-space: nowrap;
  }
  .order-pending {
    background: #8b5e3c; /* bruin */
    color: white;
  }
  .order-ready {
    background: #2f7a2f; /* groen */
    color: white;
  }
  #screenOrdersWrapper {
    display: flex;
    gap: 40px;
  }
  #screenPendingOrders, #screenReadyOrders {
    flex: 1;
  }
  #screenView {
    display: flex;
  }

  /* Keep open screen */
  #keepOpenScreen > div {
    text-align: center;
  }
  #keepOpenScreen h2 {
    font-size: 3em;
    margin-bottom: 10px;
  }
  #keepOpenScreen p {
    font-size: 1.2em;
    font-weight: bold;
  }

  /* Responsive */
  @media (max-width: 600px) {
    #tabs {
      flex-direction: column;
    }
    #screenView {
      flex-direction: column;
      height: auto;
    }
  }
</style>
</head>
<body>

<header>
  <h1>
    <svg id="homeIcon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-label="Home" role="img" tabindex="0" title="Home">
      <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
    </svg>
    Joey's Restaurant
  </h1>
  <nav>
    <a href="#/">Bestellen</a>
    <a href="#/operatorlogin">Operator Login</a>
    <a href="#/screenlogin">Display Login</a>
  </nav>
</header>

<!-- LOGIN PAGINA'S -->
<div id="loginPages">
  <div id="operatorLoginPage" class="login-page" style="display:none;">
    <h2>Operator Login</h2>
    <label for="loginUser">Gebruikersnaam</label>
    <input type="text" id="loginUser" autocomplete="username" />
    <label for="loginPass">Wachtwoord</label>
    <input type="password" id="loginPass" autocomplete="current-password" />
    <button id="operatorLoginBtn">Inloggen</button>
  </div>

  <div id="screenLoginPage" class="login-page" style="display:none;">
    <h2>Display Scherm Login</h2>
    <label for="screenUser">Gebruikersnaam</label>
    <input type="text" id="screenUser" autocomplete="username" />
    <label for="screenPass">Wachtwoord</label>
    <input type="password" id="screenPass" autocomplete="current-password" />
    <button id="screenLoginBtn">Inloggen</button>
  </div>
</div>

<!-- GASTEN BESTELSCHERM -->
<main id="mainView" style="display:none;">
  <div id="tabs" role="tablist" aria-label="Menu categorieën">
    <button role="tab" aria-selected="true" tabindex="0" data-tab="drinks" class="active">Dranken</button>
    <button role="tab" aria-selected="false" tabindex="-1" data-tab="fingerfood">Fingerfood</button>
    <button role="tab" aria-selected="false" tabindex="-1" data-tab="desserts">Desserts</button>
    <button role="tab" aria-selected="false" tabindex="-1" data-tab="menus">Menu's</button>
  </div>

  <section id="drinks" class="tab-content active" role="tabpanel" tabindex="0" aria-labelledby="drinks-tab">
    <div class="menu-item" data-name="Cola Flesje" data-price="1.50">
      Cola Flesje - €1.50 <button onclick="addToCart(event)">Bestel</button>
    </div>
    <div class="menu-item" data-name="Water Flesje" data-price="1.00">
      Water Flesje - €1.00 <button onclick="addToCart(event)">Bestel</button>
    </div>
  </section>

  <section id="fingerfood" class="tab-content" role="tabpanel" tabindex="0" aria-labelledby="fingerfood-tab">
    <div class="menu-item" data-name="Pringles Natural" data-price="0.10">
      Pringles Natural - €0.10 per chip <button onclick="openAmountPopup(event)">Aantal kiezen</button>
    </div>
    <div class="menu-item" data-name="Pringles BBQ" data-price="0.15">
      Pringles BBQ - €0.15 per chip <button onclick="openAmountPopup(event)">Aantal kiezen</button>
    </div>
  </section>

  <section id="desserts" class="tab-content" role="tabpanel" tabindex="0" aria-labelledby="desserts-tab">
    <div class="menu-item" data-name="Chocolade Cake" data-price="2.50">
      Chocolade Cake - €2.50 <button onclick="addToCart(event)">Bestel</button>
    </div>
  </section>

  <section id="menus" class="tab-content" role="tabpanel" tabindex="0" aria-labelledby="menus-tab">
    <div class="menu-item" data-name="Dagmenu" data-price="7.50">
      Dagmenu - €7.50 <button onclick="addToCart(event)">Bestel</button>
    </div>
  </section>

  <label for="orderNotes">Opmerkingen (optioneel):</label>
  <textarea id="orderNotes" placeholder="Bijv. geen peper, spoed, allergieën..." rows="3"></textarea>

  <button id="placeOrderBtn" class="btn">Bestelling plaatsen</button>
</main>

<!-- Winkelmandje knop -->
<div id="cartBtn" role="button" aria-label="Winkelmandje" tabindex="0" style="display:none;">
  Winkelmandje (<span id="cartCount">0</span>)
</div>

<!-- Winkelmandje modal -->
<div id="cartModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="cartModalTitle" tabindex="-1">
  <div class="modal-content">
    <h2 id="cartModalTitle">Je winkelmandje</h2>
    <div id="cartItems"></div>
    <button onclick="closeCart()">Sluiten</button>
  </div>
</div>

<!-- Aantal kiezen modal -->
<div id="amountModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="amountModalTitle" tabindex="-1">
  <div class="modal-content">
    <h2 id="amountModalTitle">Kies aantal chips</h2>
    <input type="number" id="amountInput" min="1" max="50" value="1" />
    <div style="margin-top: 15px;">
      <button onclick="confirmAmount()">Bevestigen</button>
      <button onclick="closeAmountPopup()">Annuleren</button>
    </div>
  </div>
</div>

<!-- Keep open scherm -->
<div id="keepOpenScreen" tabindex="0" aria-live="polite" aria-atomic="true">
  <div>
    <h2>Bestelling ontvangen!</h2>
    <p>Je bestelnummer is <span id="orderNumberDisplay">#0</span></p>
    <p><strong>Laat deze website open tot dat uw bestelling er is.</strong></p>
    <button onclick="closeKeepOpen()">Sluiten</button>
  </div>
</div>

<!-- Operator dashboard -->
<div id="operatorView" style="display:none; padding:20px;">
  <h2>Operator Dashboard</h2>
  <button id="operatorLogoutBtn">Uitloggen</button>
  <h3>Bestellingen</h3>
  <div id="operatorOrders" tabindex="0" aria-live="polite" aria-atomic="true"></div>
</div>

<!-- Order detail modal -->
<div id="orderDetailModal" class="modal" role="dialog" aria-modal="true" tabindex="-1">
  <div class="modal-content">
    <h2>Bestelling details</h2>
    <pre id="orderDetailContent"></pre>
    <label for="orderStatusSelect">Status</label>
    <select id="orderStatusSelect">
      <option value="pending">In Behandeling</option>
      <option value="ready">Klaar</option>
      <option value="longer">Kan langer duren</option>
    </select>
    <label for="extraText">Extra tekst</label>
    <textarea id="extraText" rows="2" placeholder="Bijv. vertraging of info..."></textarea>
    <div style="margin-top: 15px;">
      <button onclick="updateOrder()">Opslaan</button>
      <button onclick="deleteOrder()" style="background:#a85c5c; color:white;">Verwijderen</button>
      <button onclick="closeOrderDetail()">Sluiten</button>
    </div>
  </div>
</div>

<!-- Display scherm -->
<div id="screenView" style="display:none; padding:20px;">
  <h2>Display Scherm</h2>
  <button onclick="logoutScreen()">Uitloggen</button>
  <div id="screenOrdersWrapper" style="display:flex; gap:40px; margin-top:20px;">
    <div id="screenPendingOrders" aria-live="polite" aria-atomic="true" style="flex:1;">
      <h3>In Behandeling</h3>
    </div>
    <div id="screenReadyOrders" aria-live="polite" aria-atomic="true" style="flex:1;">
      <h3>Klaar</h3>
    </div>
  </div>
</div>

<script>
  // DATA STORAGE keys
  const STORAGE_ORDERS = 'joey_orders';
  const STORAGE_COUNTER = 'joey_order_counter';

  // Globals
  let orders = [];
  let orderCounter = 0;
  let cart = [];
  let currentAmountItem = null;

  // Elements
  const loginPages = document.getElementById('loginPages');
  const operatorLoginPage = document.getElementById('operatorLoginPage');
  const screenLoginPage = document.getElementById('screenLoginPage');
  const mainView = document.getElementById('mainView');
  const operatorView = document.getElementById('operatorView');
  const screenView = document.getElementById('screenView');
  const cartBtn = document.getElementById('cartBtn');
  const cartCount = document.getElementById('cartCount');
  const cartModal = document.getElementById('cartModal');
  const cartItems = document.getElementById('cartItems');
  const amountModal = document.getElementById('amountModal');
  const amountInput = document.getElementById('amountInput');
  const keepOpenScreen = document.getElementById('keepOpenScreen');
  const orderNumberDisplay = document.getElementById('orderNumberDisplay');
  const operatorOrders = document.getElementById('operatorOrders');
  const operatorLogoutBtn = document.getElementById('operatorLogoutBtn');
  const orderDetailModal = document.getElementById('orderDetailModal');
  const orderDetailContent = document.getElementById('orderDetailContent');
  const orderStatusSelect = document.getElementById('orderStatusSelect');
  const extraText = document.getElementById('extraText');
  const screenPendingOrders = document.getElementById('screenPendingOrders');
  const screenReadyOrders = document.getElementById('screenReadyOrders');
  const operatorLoginBtn = document.getElementById('operatorLoginBtn');
  const screenLoginBtn = document.getElementById('screenLoginBtn');
  const loginUserInput = document.getElementById('loginUser');
  const loginPassInput = document.getElementById('loginPass');
  const screenUserInput = document.getElementById('screenUser');
  const screenPassInput = document.getElementById('screenPass');
  const tabsButtons = document.querySelectorAll('#tabs button');
  const tabContents = document.querySelectorAll('.tab-content');
  const homeIcon = document.getElementById('homeIcon');

  // On load
  window.onload = () => {
    loadData();
    handleHash();
  };

  // Load data
  function loadData() {
    const savedOrders = localStorage.getItem(STORAGE_ORDERS);
    orders = savedOrders ? JSON.parse(savedOrders) : [];
    const savedCounter = localStorage.getItem(STORAGE_COUNTER);
    orderCounter = savedCounter ? Number(savedCounter) : 0;
  }
  // Save data
  function saveData() {
    localStorage.setItem(STORAGE_ORDERS, JSON.stringify(orders));
    localStorage.setItem(STORAGE_COUNTER, orderCounter.toString());
  }

  // Hash change handler
  window.addEventListener('hashchange', handleHash);
  function handleHash() {
    const hash = location.hash || '#/';
    if(hash === '#/operatorlogin') {
      showLoginPage('operator');
    } else if(hash === '#/screenlogin') {
      showLoginPage('screen');
    } else if(hash === '#/operator') {
      showOperatorView();
    } else if(hash === '#/screen') {
      showScreenView();
    } else {
      showGuestView();
    }
  }

  // Show login page
  function showLoginPage(type) {
    loginPages.style.display = 'flex';
    mainView.style.display = 'none';
    operatorView.style.display = 'none';
    screenView.style.display = 'none';
    cartBtn.style.display = 'none';

    operatorLoginPage.style.display = 'none';
    screenLoginPage.style.display = 'none';

    if(type === 'operator') {
      operatorLoginPage.style.display = 'block';
    } else if(type === 'screen') {
      screenLoginPage.style.display = 'block';
    }
  }

  // Show guest view
  function showGuestView() {
    loginPages.style.display = 'none';
    mainView.style.display = 'block';
    operatorView.style.display = 'none';
    screenView.style.display = 'none';
    cartBtn.style.display = cart.length > 0 ? 'flex' : 'none';
  }

  // Show operator dashboard
  function showOperatorView() {
    loginPages.style.display = 'none';
    mainView.style.display = 'none';
    operatorView.style.display = 'block';
    screenView.style.display = 'none';
    cartBtn.style.display = 'none';
    renderOperatorOrders();
  }

  // Show screen display
  function showScreenView() {
    loginPages.style.display = 'none';
    mainView.style.display = 'none';
    operatorView.style.display = 'none';
    screenView.style.display = 'flex';
    cartBtn.style.display = 'none';
    renderScreenOrders();
  }

  // Tabs logic
  tabsButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      tabsButtons.forEach(b => {
        b.classList.remove('active');
        b.setAttribute('aria-selected', 'false');
        b.setAttribute('tabindex', '-1');
      });
      btn.classList.add('active');
      btn.setAttribute('aria-selected', 'true');
      btn.setAttribute('tabindex', '0');

      const tab = btn.getAttribute('data-tab');
      tabContents.forEach(tc => {
        tc.classList.toggle('active', tc.id === tab);
      });
    });
  });

  // Add to cart (for normal items)
  function addToCart(e) {
    const menuItem = e.target.closest('.menu-item');
    if(!menuItem) return;
    const name = menuItem.getAttribute('data-name');
    const price = Number(menuItem.getAttribute('data-price'));
    addItemToCart(name, price, 1);
  }

  // Open amount popup (for chips)
  function openAmountPopup(e) {
    const menuItem = e.target.closest('.menu-item');
    if(!menuItem) return;
    currentAmountItem = {
      name: menuItem.getAttribute('data-name'),
      price: Number(menuItem.getAttribute('data-price'))
    };
    amountInput.value = 1;
    amountModal.classList.add('active');
    amountInput.focus();
  }

  function closeAmountPopup() {
    amountModal.classList.remove('active');
    currentAmountItem = null;
  }

  function confirmAmount() {
    let amount = parseInt(amountInput.value);
    if(isNaN(amount) || amount < 1) amount = 1;
    if(amount > 50) amount = 50;
    addItemToCart(currentAmountItem.name, currentAmountItem.price, amount);
    closeAmountPopup();
  }

  // Add item to cart, merge same items
  function addItemToCart(name, price, amount) {
    const existing = cart.find(i => i.name === name && i.price === price);
    if(existing) {
      existing.amount += amount;
    } else {
      cart.push({name, price, amount});
    }
    updateCartCount();
  }

  // Update cart count
  function updateCartCount() {
    let total = 0;
    for(const i of cart) total += i.amount;
    cartCount.textContent = total;
    cartBtn.style.display = total > 0 ? 'flex' : 'none';
  }

  // Cart button open
  cartBtn.addEventListener('click', () => {
    renderCartItems();
    cartModal.classList.add('active');
    cartModal.focus();
  });
  function closeCart() {
    cartModal.classList.remove('active');
  }
  function renderCartItems() {
    if(cart.length === 0) {
      cartItems.innerHTML = '<p>Winkelmandje is leeg.</p>';
      return;
    }
    let html = '<ul style="list-style:none; padding-left:0;">';
    for(const item of cart) {
      html += `<li>${item.name} x${item.amount} - €${(item.price*item.amount).toFixed(2)}</li>`;
    }
    html += '</ul>';
    cartItems.innerHTML = html;
  }

  // Place order
  document.getElementById('placeOrderBtn').addEventListener('click', () => {
    if(cart.length === 0) {
      alert('Je winkelmandje is leeg!');
      return;
    }
    const notes = document.getElementById('orderNotes').value.trim();
    placeOrder(notes);
  });

  function placeOrder(notes) {
    orderCounter++;
    const orderId = orderCounter;
    let orderText = '';
    for(const item of cart) {
      orderText += `${item.name} x${item.amount} - €${(item.price*item.amount).toFixed(2)}\n`;
    }
    if(notes) orderText += `Opmerkingen: ${notes}\n`;

    orders.push({
      id: orderId,
      orderText,
      status: 'pending',
      extraText: '',
      timestamp: Date.now()
    });
    saveData();

    cart = [];
    updateCartCount();
    document.getElementById('orderNotes').value = '';

    orderNumberDisplay.textContent = `#${orderId}`;
    keepOpenScreen.classList.add('active');

    renderScreenOrders();
    renderOperatorOrders();
  }
  function closeKeepOpen() {
    keepOpenScreen.classList.remove('active');
    showGuestView();
  }

  // Operator login
  operatorLoginBtn.addEventListener('click', () => {
    const user = loginUserInput.value.trim();
    const pass = loginPassInput.value.trim();
    if(user === 'Operator' && pass === '8008') {
      showOperatorView();
      loginUserInput.value = '';
      loginPassInput.value = '';
      history.pushState(null,null,'#/operator');
    } else {
      alert('Foute gebruikersnaam of wachtwoord.');
    }
  });

  // Operator logout
  operatorLogoutBtn.addEventListener('click', () => {
    if(confirm('Weet je zeker dat je wil uitloggen?')) {
      showLoginPage('operator');
      history.pushState(null,null,'#/operatorlogin');
    }
  });

  // Screen login
  screenLoginBtn.addEventListener('click', () => {
    const user = screenUserInput.value.trim();
    const pass = screenPassInput.value.trim();
    if(user === 'OperatorScreen' && pass === '8008') {
      showScreenView();
      screenUserInput.value = '';
      screenPassInput.value = '';
      history.pushState(null,null,'#/screen');
    } else {
      alert('Foute gebruikersnaam of wachtwoord.');
    }
  });

  // Screen logout function
  function logoutScreen() {
    if(confirm('Weet je zeker dat je wil uitloggen?')) {
      showLoginPage('screen');
      history.pushState(null,null,'#/screenlogin');
    }
  }

  // Render operator orders
  function renderOperatorOrders() {
    if(orders.length === 0) {
      operatorOrders.innerHTML = '<p>Geen bestellingen.</p>';
      return;
    }
    const sorted = orders.slice().sort((a,b) => a.timestamp - b.timestamp);
    let html = '';
    for(const order of sorted) {
      html += `<div class="order-item" tabindex="0" data-id="${order.id}">Bestelnummer #${order.id} - Status: ${statusToText(order.status)}${order.extraText ? ' - ' + order.extraText : ''}</div>`;
    }
    operatorOrders.innerHTML = html;

    // Events to open detail
    const items = operatorOrders.querySelectorAll('.order-item');
    items.forEach(item => {
      item.onclick = () => openOrderDetail(item.getAttribute('data-id'));
      item.onkeypress = e => { if(e.key==='Enter') openOrderDetail(item.getAttribute('data-id')); };
    });
  }

  // Status to readable text
  function statusToText(status) {
    switch(status) {
      case 'pending': return 'In Behandeling';
      case 'ready': return 'Klaar';
      case 'longer': return 'Kan langer duren';
      default: return status;
    }
  }

  // Open order detail modal
  let selectedOrderId = null;
  function openOrderDetail(id) {
    selectedOrderId = Number(id);
    const order = orders.find(o => o.id === selectedOrderId);
    if(!order) return alert('Bestelling niet gevonden.');
    orderDetailContent.textContent = order.orderText;
    orderStatusSelect.value = order.status;
    extraText.value = order.extraText || '';
    orderDetailModal.classList.add('active');
  }
  function closeOrderDetail() {
    orderDetailModal.classList.remove('active');
    selectedOrderId = null;
  }

  // Update order
  function updateOrder() {
    if(selectedOrderId === null) return;
    const order = orders.find(o => o.id === selectedOrderId);
    if(!order) return alert('Bestelling niet gevonden.');
    order.status = orderStatusSelect.value;
    order.extraText = extraText.value.trim();
    saveData();
    renderOperatorOrders();
    renderScreenOrders();
    closeOrderDetail();
  }

  // Delete order
  function deleteOrder() {
    if(selectedOrderId === null) return;
    if(!confirm('Weet je zeker dat je deze bestelling wilt verwijderen?')) return;
    orders = orders.filter(o => o.id !== selectedOrderId);
    saveData();
    renderOperatorOrders();
    renderScreenOrders();
    closeOrderDetail();
  }

  // Render screen display orders
  function renderScreenOrders() {
    screenPendingOrders.innerHTML = '';
    screenReadyOrders.innerHTML = '';

    const sorted = orders.slice().sort((a,b) => a.timestamp - b.timestamp);

    for(const order of sorted) {
      const div = document.createElement('div');
      div.textContent = `#${order.id}`;
      div.classList.add('order-item-screen');
      if(order.status === 'ready') {
        div.classList.add('order-ready');
        screenReadyOrders.appendChild(div);
      } else {
        div.classList.add('order-pending');
        screenPendingOrders.appendChild(div);
      }
    }
  }

  // Polling updates elke 3 sec
  let lastReadyIds = new Set();
  setInterval(() => {
    if(operatorView.style.display === 'block') {
      renderOperatorOrders();
    }
    if(screenView.style.display === 'flex') {
      const readyOrders = orders.filter(o => o.status === 'ready').map(o => o.id);
      // Check nieuwe klaar orders
      const newReady = readyOrders.filter(id => !lastReadyIds.has(id));
      if(newReady.length > 0) playDoneSound();
      lastReadyIds = new Set(readyOrders);
      renderScreenOrders();
    }
  }, 3000);

  // Geluid afspelen als bestelling klaar is
  function playDoneSound() {
    const sound = new Audio('DoneSoundForScreen.mp3');
    sound.play().catch(e => { /* fallback geen geluid */ });
  }

  // Home icon click
  homeIcon.addEventListener('click', () => {
    location.hash = '#/';
  });

</script>

</body>
</html>
