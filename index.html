<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Restaurant Bestelsysteem</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0; padding: 0;
    background: #fafafa;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }
  header {
    background: #333;
    color: white;
    padding: 15px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  header h1 {
    margin: 0;
    font-weight: normal;
    font-size: 1.5rem;
  }
  nav a {
    color: white;
    text-decoration: none;
    font-weight: bold;
    margin-left: 15px;
    cursor: pointer;
  }
  nav a:hover {
    text-decoration: underline;
  }
  main {
    flex-grow: 1;
    padding: 20px;
  }
  #tabs {
    display: flex;
    gap: 15px;
    margin-bottom: 20px;
  }
  #tabs button {
    background: #ddd;
    border: none;
    padding: 10px 20px;
    cursor: pointer;
    border-radius: 5px 5px 0 0;
    font-weight: bold;
    transition: background 0.3s;
  }
  #tabs button.active {
    background: #333;
    color: white;
  }
  .tab-content {
    display: none;
    background: white;
    padding: 15px;
    border: 1px solid #ccc;
    border-top: none;
    border-radius: 0 5px 5px 5px;
    min-height: 200px;
  }
  .tab-content.active {
    display: block;
  }
  .menu-item {
    border-bottom: 1px solid #eee;
    padding: 10px 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .menu-item button {
    background: #4CAF50;
    border: none;
    color: white;
    padding: 6px 12px;
    border-radius: 4px;
    cursor: pointer;
    transition: background 0.3s;
  }
  .menu-item button:hover {
    background: #45a049;
  }
  #cartBtn {
    position: fixed;
    right: 20px;
    bottom: 20px;
    background: #e91e63;
    border: none;
    color: white;
    padding: 15px 20px;
    font-weight: bold;
    border-radius: 50px;
    cursor: pointer;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    display: flex;
    align-items: center;
    gap: 10px;
    z-index: 1000;
  }
  #cartCount {
    background: white;
    color: #e91e63;
    border-radius: 50%;
    padding: 2px 7px;
    font-weight: bold;
    font-size: 0.9rem;
    min-width: 24px;
    text-align: center;
  }
  .modal {
    position: fixed;
    top:0; left:0; right:0; bottom:0;
    background: rgba(0,0,0,0.5);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 2000;
  }
  .modal.active {
    display: flex;
  }
  .modal-content {
    background: white;
    padding: 25px;
    border-radius: 10px;
    max-width: 400px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
  }
  .modal-content h2, .modal-content h3 {
    margin-top: 0;
  }
  .modal-footer {
    margin-top: 15px;
    text-align: right;
  }
  .modal-footer .btn {
    margin-left: 10px;
  }
  .btn {
    padding: 8px 16px;
    border: none;
    background: #4CAF50;
    color: white;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
    transition: background 0.3s;
  }
  .btn:hover {
    background: #45a049;
  }
  .btn.cancel {
    background: #f44336;
  }
  .btn.cancel:hover {
    background: #d32f2f;
  }
  #operatorOrders .order-item {
    border-bottom: 1px solid #ccc;
    padding: 8px 0;
    cursor: pointer;
  }
  #operatorOrders .order-item:hover {
    background: #f0f0f0;
  }
  #screenView {
    display: none;
    flex-direction: row;
    justify-content: space-around;
    padding: 20px;
    gap: 40px;
    flex-wrap: wrap;
    background: #222;
    color: white;
    min-height: 80vh;
  }
  #screenView > div {
    flex: 1 1 40%;
    background: #333;
    border-radius: 10px;
    padding: 15px;
    min-width: 250px;
    max-height: 70vh;
    overflow-y: auto;
  }
  #screenView h3 {
    margin-top: 0;
    border-bottom: 2px solid #aaa;
    padding-bottom: 10px;
  }
  .order-item-screen {
    font-size: 2rem;
    font-weight: bold;
    margin-bottom: 10px;
    border-radius: 5px;
    padding: 10px;
    color: white;
  }
  .order-pending {
    background: #a0522d; /* bruin */
    text-align: left;
  }
  .order-ready {
    background: #2e8b57; /* groen */
    text-align: right;
  }
  #loginPages {
    display: none;
    min-height: 80vh;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .login-page {
    background: white;
    padding: 30px 40px;
    border-radius: 12px;
    box-shadow: 0 10px 20px rgba(0,0,0,0.3);
    width: 320px;
  }
  .login-page h2 {
    margin-top: 0;
    margin-bottom: 20px;
    text-align: center;
  }
  .login-page label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
  }
  .login-page input {
    width: 100%;
    padding: 8px 10px;
    margin-bottom: 15px;
    border: 1px solid #ccc;
    border-radius: 6px;
    font-size: 1rem;
  }
  .login-page button {
    width: 100%;
    font-size: 1rem;
  }
  @media(max-width: 700px) {
    #screenView {
      flex-direction: column;
    }
    #screenView > div {
      max-width: 100%;
    }
    #tabs {
      flex-wrap: wrap;
    }
  }
</style>
</head>
<body>

<header>
  <h1>RLogo Restaurant</h1>
  <nav>
    <a href="#/">Bestellen</a>
    <a href="#/operatorlogin">Operator Login</a>
    <a href="#/screenlogin">Scherm Login</a>
  </nav>
</header>

<!-- Main bestel systeem -->
<main id="mainView" role="main" aria-label="Bestelsysteem">
  <div id="tabs" role="tablist" aria-label="CategorieÃ«n">
    <button role="tab" aria-selected="true" data-tab="drinksTab" tabindex="0" class="active">Dranken</button>
    <button role="tab" aria-selected="false" data-tab="fingerfoodTab" tabindex="-1">Fingerfood</button>
    <button role="tab" aria-selected="false" data-tab="dessertsTab" tabindex="-1">Desserts</button>
    <button role="tab" aria-selected="false" data-tab="menusTab" tabindex="-1">Menu's</button>
  </div>

  <section id="drinksTab" class="tab-content active" role="tabpanel" tabindex="0" aria-hidden="false">
    <div class="menu-item" data-name="Cola" data-price="1.50">
      <div>Cola - â‚¬1.50</div>
      <button type="button" onclick="addToCart(event)">Voeg toe</button>
    </div>
    <div class="menu-item" data-name="Water" data-price="1.00">
      <div>Water - â‚¬1.00</div>
      <button type="button" onclick="addToCart(event)">Voeg toe</button>
    </div>
  </section>

  <section id="fingerfoodTab" class="tab-content" role="tabpanel" tabindex="0" aria-hidden="true">
    <div class="menu-item" data-name="Pringles Natural" data-price="0.10">
      <div>Pringles Natural - â‚¬0.10 per chip</div>
      <button type="button" onclick="openAmountPopup(event)">Aantal kiezen</button>
    </div>
    <div class="menu-item" data-name="Pringles BBQ-saus" data-price="0.12">
      <div>Pringles BBQ-saus - â‚¬0.12 per chip</div>
      <button type="button" onclick="openAmountPopup(event)">Aantal kiezen</button>
    </div>
  </section>

  <section id="dessertsTab" class="tab-content" role="tabpanel" tabindex="0" aria-hidden="true">
    <div class="menu-item" data-name="Chocolade Taart" data-price="2.50">
      <div>Chocolade Taart - â‚¬2.50</div>
      <button type="button" onclick="addToCart(event)">Voeg toe</button>
    </div>
    <div class="menu-item" data-name="Vanille Ijs" data-price="2.00">
      <div>Vanille Ijs - â‚¬2.00</div>
      <button type="button" onclick="addToCart(event)">Voeg toe</button>
    </div>
  </section>

  <section id="menusTab" class="tab-content" role="tabpanel" tabindex="0" aria-hidden="true">
    <div class="menu-item" data-name="Menu Kinder" data-price="5.00">
      <div>Menu Kinder - â‚¬5.00</div>
      <button type="button" onclick="addToCart(event)">Voeg toe</button>
    </div>
    <div class="menu-item" data-name="Menu Volwassen" data-price="9.00">
      <div>Menu Volwassen - â‚¬9.00</div>
      <button type="button" onclick="addToCart(event)">Voeg toe</button>
    </div>
  </section>
</main>

<!-- Winkelmandje knop -->
<button id="cartBtn" aria-label="Winkelmandje">
  ðŸ›’ <span id="cartCount">0</span>
</button>

<!-- Modals -->

<!-- Aantal chips modal -->
<div class="modal" id="amountModal" role="dialog" aria-modal="true" aria-labelledby="amountModalTitle" tabindex="-1">
  <div class="modal-content">
    <h2 id="amountModalTitle">Kies aantal chips</h2>
    <input type="number" id="amountInput" min="1" max="50" value="1" aria-label="Aantal chips" />
    <div class="modal-footer">
      <button class="btn" type="button" onclick="confirmAmount()">Bevestigen</button>
      <button class="btn cancel" type="button" onclick="closeAmountPopup()">Annuleren</button>
    </div>
  </div>
</div>

<!-- Winkelmandje modal -->
<div class="modal" id="cartModal" role="dialog" aria-modal="true" aria-labelledby="cartModalTitle" tabindex="-1">
  <div class="modal-content">
    <h2 id="cartModalTitle">Winkelmandje</h2>
    <div id="cartItems" aria-live="polite">Winkelmandje is leeg.</div>
    <label for="orderNotes">Opmerkingen / AllergieÃ«n (optioneel):</label>
    <textarea id="orderNotes" placeholder="Bijv. Geen pinda's..." rows="3" aria-label="Opmerkingen of allergieÃ«n"></textarea>
    <div class="modal-footer">
      <button class="btn" type="button" onclick="placeOrder()">Bestelling plaatsen</button>
      <button class="btn cancel" type="button" onclick="closeCart()">Sluiten</button>
    </div>
  </div>
</div>

<!-- Bestelling geplaatst scherm -->
<div class="modal" id="keepOpenScreen" role="dialog" aria-modal="true" aria-labelledby="keepOpenTitle" tabindex="-1">
  <div class="modal-content" style="text-align:center;">
    <p>Uw bestelling is geplaatst! Uw bestelnummer is:</p>
    <div id="orderNumberDisplay" style="font-size: 2rem; font-weight: bold;">#0</div>
    <p>Laat deze website open totdat uw bestelling klaar is.</p>
    <button class="btn" type="button" onclick="closeKeepOpen()">Sluiten</button>
  </div>
</div>

<!-- Operator view -->
<div id="operatorView" style="display:none; padding: 20px;">
  <h2>Operator Bestellingen</h2>
  <div id="operatorOrders" aria-live="polite">Geen bestellingen.</div>
  <div class="modal-footer" style="margin-top:20px;">
    <button class="btn cancel" type="button" onclick="logoutOperator()" id="operatorLogoutBtn">Uitloggen</button>
  </div>
</div>

<!-- Order detail modal -->
<div class="modal" id="orderDetailModal" role="dialog" aria-modal="true" aria-labelledby="orderDetailTitle" tabindex="-1">
  <div class="modal-content">
    <h3 id="orderDetailTitle">Bestelling Details</h3>
    <pre id="orderDetailContent" style="white-space: pre-wrap; font-family: monospace; background:#f7f7f7; padding:10px; border-radius:6px; max-height: 150px; overflow-y: auto;"></pre>
    <label for="orderStatusSelect">Status:</label>
    <select id="orderStatusSelect" aria-label="Status wijzigen">
      <option value="pending">In Behandeling</option>
      <option value="ready">Klaar</option>
      <option value="delayed">Kan langer duren</option>
    </select>
    <label for="extraText">Extra tekst (optioneel):</label>
    <textarea id="extraText" rows="3" placeholder="Bijv. spoed" aria-label="Extra tekst"></textarea>
    <div class="modal-footer">
      <button class="btn" type="button" onclick="updateOrder()">Opslaan</button>
      <button class="btn cancel" type="button" onclick="deleteOrder()">Verwijderen</button>
      <button class="btn cancel" type="button" onclick="closeOrderDetail()">Sluiten</button>
    </div>
  </div>
</div>

<!-- Operator login pagina -->
<div id="loginPages" style="display:none; justify-content:center; align-items:center; min-height: 80vh; background:#fafafa;">
  <div id="operatorLoginPage" class="login-page" style="display:none;">
    <h2>Operator Login</h2>
    <label for="loginUser">Gebruikersnaam</label>
    <input type="text" id="loginUser" autocomplete="username" />
    <label for="loginPass">Wachtwoord</label>
    <input type="password" id="loginPass" autocomplete="current-password" />
    <button class="btn" type="button" id="operatorLoginBtn">Inloggen</button>
  </div>
  <div id="screenLoginPage" class="login-page" style="display:none;">
    <h2>Scherm Login</h2>
    <label for="screenUser">Gebruikersnaam</label>
    <input type="text" id="screenUser" autocomplete="username" />
    <label for="screenPass">Wachtwoord</label>
    <input type="password" id="screenPass" autocomplete="current-password" />
    <button class="btn" type="button" id="screenLoginBtn">Inloggen</button>
  </div>
</div>

<!-- Scherm account view -->
<div id="screenView" style="display:none; flex-direction: row; padding: 20px; gap: 20px;">
  <div>
    <h3>In Behandeling</h3>
    <div id="screenPendingOrders" aria-live="polite"></div>
  </div>
  <div>
    <h3>Klaar</h3>
    <div id="screenReadyOrders" aria-live="polite"></div>
  </div>
  <button class="btn cancel" style="position: fixed; top: 20px; right: 20px;" id="screenLogoutBtn">Uitloggen</button>
  <audio id="doneSound" src="Sounds/DoneSoundForScreen.mp3" preload="auto"></audio>
</div>

<script>
(() => {
  const BIN_ID = '688f6efe7b4b8670d8ac3f46';
  const API_KEY = '$2a$10$XpZeyd.RhynC0Ie0VWma7uJPbMYdUAIHuG24Smc5V0C5LU5d11H5O';

  // State
  let ordersData = { counter: 0, orders: [] };
  let cart = [];
  let currentAmountItem = null;
  let editingOrder = null;
  let loggedInOperator = false;
  let loggedInScreen = false;

  // Elements
  const tabs = [...document.querySelectorAll('#tabs button')];
  const cartBtn = document.getElementById('cartBtn');
  const cartCount = document.getElementById('cartCount');
  const cartModal = document.getElementById('cartModal');
  const cartItemsDiv = document.getElementById('cartItems');
  const orderNotes = document.getElementById('orderNotes');

  const amountModal = document.getElementById('amountModal');
  const amountInput = document.getElementById('amountInput');

  const keepOpenScreen = document.getElementById('keepOpenScreen');
  const orderNumberDisplay = document.getElementById('orderNumberDisplay');

  const loginPages = document.getElementById('loginPages');
  const operatorLoginPage = document.getElementById('operatorLoginPage');
  const screenLoginPage = document.getElementById('screenLoginPage');

  const mainView = document.getElementById('mainView');
  const operatorView = document.getElementById('operatorView');
  const operatorOrdersDiv = document.getElementById('operatorOrders');
  const orderDetailModal = document.getElementById('orderDetailModal');
  const orderDetailContent = document.getElementById('orderDetailContent');
  const orderStatusSelect = document.getElementById('orderStatusSelect');
  const extraTextInput = document.getElementById('extraText');

  const screenView = document.getElementById('screenView');
  const screenPendingOrdersDiv = document.getElementById('screenPendingOrders');
  const screenReadyOrdersDiv = document.getElementById('screenReadyOrders');

  const doneSound = document.getElementById('doneSound');

  // Helpers

  function showView(viewName) {
    // Verberg alles eerst
    mainView.style.display = 'none';
    operatorView.style.display = 'none';
    loginPages.style.display = 'none';
    screenView.style.display = 'none';
    cartBtn.style.display = 'none';

    // Toon wat nodig is
    if (viewName === 'main') {
      mainView.style.display = 'block';
      cartBtn.style.display = 'flex';
    } else if (viewName === 'operatorLogin') {
      loginPages.style.display = 'flex';
      operatorLoginPage.style.display = 'block';
      screenLoginPage.style.display = 'none';
    } else if (viewName === 'screenLogin') {
      loginPages.style.display = 'flex';
      operatorLoginPage.style.display = 'none';
      screenLoginPage.style.display = 'block';
    } else if (viewName === 'operatorView') {
      operatorView.style.display = 'block';
    } else if (viewName === 'screenView') {
      screenView.style.display = 'flex';
    }
  }

  // Hash-based routing

  function handleRoute() {
    const hash = location.hash || '#/';
    if (hash === '#/' || hash === '#') {
      // hoofd bestel scherm
      showView('main');
    } else if (hash === '#/operatorlogin') {
      showView('operatorLogin');
    } else if (hash === '#/operatorview') {
      if (loggedInOperator) {
        showView('operatorView');
      } else {
        location.hash = '#/operatorlogin';
      }
    } else if (hash === '#/screenlogin') {
      showView('screenLogin');
    } else if (hash === '#/screenview') {
      if (loggedInScreen) {
        showView('screenView');
      } else {
        location.hash = '#/screenlogin';
      }
    } else {
      // fallback
      location.hash = '#/';
    }
  }
  window.addEventListener('hashchange', handleRoute);

  // Tabs switching
  tabs.forEach(btn => {
    btn.addEventListener('click', () => {
      tabs.forEach(b => {
        b.classList.remove('active');
        b.setAttribute('aria-selected', 'false');
        b.tabIndex = -1;
      });
      btn.classList.add('active');
      btn.setAttribute('aria-selected', 'true');
      btn.tabIndex = 0;
      document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
      const target = btn.dataset.tab;
      document.getElementById(target).classList.add('active');
    });
  });

  // Cart logic
  function addToCart(event) {
    const itemDiv = event.target.closest('.menu-item');
    const name = itemDiv.dataset.name;
    const price = parseFloat(itemDiv.dataset.price);
    if (name.toLowerCase().includes('pringles')) {
      openAmountPopup(event);
      return;
    }
    const found = cart.find(i => i.name === name);
    if (found) {
      found.amount++;
    } else {
      cart.push({name, price, amount:1});
    }
    updateCartCount();
  }
  window.addToCart = addToCart;

  // Amount popup for pringles
  function openAmountPopup(event) {
    currentAmountItem = event.target.closest('.menu-item');
    amountInput.value = 1;
    amountModal.classList.add('active');
    amountInput.focus();
  }
  window.openAmountPopup = openAmountPopup;

  function closeAmountPopup() {
    currentAmountItem = null;
    amountModal.classList.remove('active');
  }
  window.closeAmountPopup = closeAmountPopup;

  function confirmAmount() {
    const amount = parseInt(amountInput.value);
    if (isNaN(amount) || amount < 1 || amount > 50) {
      alert('Voer een getal in tussen 1 en 50.');
      amountInput.focus();
      return;
    }
    const name = currentAmountItem.dataset.name;
    const price = parseFloat(currentAmountItem.dataset.price);
    const found = cart.find(i => i.name === name);
    if (found) {
      found.amount += amount;
    } else {
      cart.push({name, price, amount});
    }
    updateCartCount();
    closeAmountPopup();
  }
  window.confirmAmount = confirmAmount;

  // Update cart count display
  function updateCartCount() {
    let total = 0;
    cart.forEach(i => total += i.amount);
    cartCount.textContent = total;
  }

  // Open/close cart modal
  cartBtn.addEventListener('click', () => {
    renderCartItems();
    cartModal.classList.add('active');
    orderNotes.focus();
  });

  function closeCart() {
    cartModal.classList.remove('active');
  }
  window.closeCart = closeCart;

  // Render cart items
  function renderCartItems() {
    if(cart.length === 0) {
      cartItemsDiv.textContent = 'Winkelmandje is leeg.';
      return;
    }
    cartItemsDiv.innerHTML = '';
    cart.forEach((item) => {
      const div = document.createElement('div');
      div.textContent = `${item.name} x${item.amount} - â‚¬${(item.price * item.amount).toFixed(2)}`;
      cartItemsDiv.appendChild(div);
    });
  }

  // Place order (met opmerkingen)
  async function placeOrder() {
    if(cart.length === 0) {
      alert('Winkelmandje is leeg!');
      return;
    }
    const notes = orderNotes.value.trim();

    ordersData.counter = parseInt(ordersData.counter) || 0;
    ordersData.counter++;
    const orderNumber = ordersData.counter;

    const newOrder = {
      number: orderNumber,
      items: [...cart],
      status: 'pending',
      extraText: '',
      notes,
      created: new Date().toISOString()
    };
    ordersData.orders.push(newOrder);
    await saveOrdersData();

    // reset winkelmandje
    cart = [];
    updateCartCount();
    orderNotes.value = '';
    closeCart();

    // Toon keep open scherm met bestelnummer
    orderNumberDisplay.textContent = `#${orderNumber}`;
    keepOpenScreen.classList.add('active');

    // Update operator en scherm views
    if(loggedInOperator) renderOperatorOrders();
    if(loggedInScreen) renderScreenOrders();
  }
  window.placeOrder = placeOrder;

  function closeKeepOpen() {
    keepOpenScreen.classList.remove('active');
    location.hash = '#/';
  }
  window.closeKeepOpen = closeKeepOpen;

  // Operator login
  async function operatorLogin() {
    const user = document.getElementById('loginUser').value.trim();
    const pass = document.getElementById('loginPass').value.trim();

    if(user === 'Operator' && pass === '8008') {
      loggedInOperator = true;
      location.hash = '#/operatorview';
      await loadOrdersData();
      renderOperatorOrders();
    } else {
      alert('Verkeerde inloggegevens.');
    }
  }
  document.getElementById('operatorLoginBtn').addEventListener('click', operatorLogin);

  function logoutOperator() {
    loggedInOperator = false;
    location.hash = '#/';
  }
  window.logoutOperator = logoutOperator;
  document.getElementById('operatorLogoutBtn').addEventListener('click', logoutOperator);

  // Screen login
  async function screenLogin() {
    const user = document.getElementById('screenUser').value.trim();
    const pass = document.getElementById('screenPass').value.trim();

    if(user === 'OperatorScreen' && pass === '8008') {
      loggedInScreen = true;
      location.hash = '#/screenview';
      await loadOrdersData();
      renderScreenOrders();
    } else {
      alert('Verkeerde inloggegevens.');
    }
  }
  document.getElementById('screenLoginBtn').addEventListener('click', screenLogin);

  function screenLogout() {
    loggedInScreen = false;
    location.hash = '#/';
  }
  window.screenLogout = screenLogout;
  document.getElementById('screenLogoutBtn').addEventListener('click', screenLogout);

  // Load and save data JSONBin
  async function loadOrdersData() {
    try {
      const res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
        headers: { 'X-Master-Key': API_KEY }
      });
      const json = await res.json();
      if(json.record) {
        ordersData = json.record;
        ordersData.counter = parseInt(ordersData.counter) || 0;
        if(!ordersData.orders) ordersData.orders = [];
      } else {
        ordersData = { counter: 0, orders: [] };
      }
    } catch(e) {
      console.warn('Kon niet data laden, gebruik cache.');
    }
  }
  async function saveOrdersData() {
    try {
      await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json',
          'X-Master-Key': API_KEY
        },
        body: JSON.stringify(ordersData)
      });
    } catch(e) {
      alert('Fout bij opslaan, probeer opnieuw.');
    }
  }

  // Render operator orders
  function renderOperatorOrders() {
    if(!loggedInOperator) return;
    operatorOrdersDiv.innerHTML = '';
    if(ordersData.orders.length === 0) {
      operatorOrdersDiv.textContent = 'Geen bestellingen.';
      return;
    }
    ordersData.orders.forEach(order => {
      const div = document.createElement('div');
      div.className = 'order-item';
      div.textContent = `#${order.number} - ${new Date(order.created).toLocaleString()} - Status: ${statusText(order.status)}`;
      div.tabIndex = 0;
      div.setAttribute('role','button');
      div.addEventListener('click', () => openOrderDetail(order.number));
      operatorOrdersDiv.appendChild(div);
    });
  }

  // Open order detail modal
  function openOrderDetail(orderNumber) {
    editingOrder = ordersData.orders.find(o => o.number === orderNumber);
    if(!editingOrder) return alert('Bestelling niet gevonden.');

    orderDetailContent.textContent = editingOrder.items.map(i => `${i.name} x${i.amount} - â‚¬${(i.price*i.amount).toFixed(2)}`).join('\n');
    orderStatusSelect.value = editingOrder.status;
    extraTextInput.value = editingOrder.extraText || '';
    orderDetailModal.classList.add('active');
    orderStatusSelect.focus();
  }

  // Close order detail
  function closeOrderDetail() {
    orderDetailModal.classList.remove('active');
    editingOrder = null;
  }
  window.closeOrderDetail = closeOrderDetail;

  // Update order (status en extra tekst)
  async function updateOrder() {
    if(!editingOrder) return;
    editingOrder.status = orderStatusSelect.value;
    editingOrder.extraText = extraTextInput.value.trim();
    await saveOrdersData();
    renderOperatorOrders();
    renderScreenOrders();
    closeOrderDetail();
  }
  window.updateOrder = updateOrder;

  // Delete order
  async function deleteOrder() {
    if(!editingOrder) return;
    if(!confirm(`Weet je zeker dat je bestelling #${editingOrder.number} wilt verwijderen?`)) return;
    ordersData.orders = ordersData.orders.filter(o => o.number !== editingOrder.number);
    await saveOrdersData();
    renderOperatorOrders();
    renderScreenOrders();
    closeOrderDetail();
  }
  window.deleteOrder = deleteOrder;

  // Render screen orders
  function renderScreenOrders() {
    if(!loggedInScreen) return;
    screenPendingOrdersDiv.innerHTML = '';
    screenReadyOrdersDiv.innerHTML = '';

    const pendingOrders = ordersData.orders.filter(o => o.status === 'pending');
    const readyOrders = ordersData.orders.filter(o => o.status === 'ready');

    pendingOrders.forEach(o => {
      const div = document.createElement('div');
      div.className = 'order-item-screen order-pending';
      div.textContent = `#${o.number}`;
      screenPendingOrdersDiv.appendChild(div);
    });
    readyOrders.forEach(o => {
      const div = document.createElement('div');
      div.className = 'order-item-screen order-ready';
      div.textContent = `#${o.number}`;
      screenReadyOrdersDiv.appendChild(div);
    });

    // Speel sound af als er nieuwe klaar komen
    if(readyOrders.length > 0 && !doneSound.played) {
      doneSound.play().catch(() => {});
      doneSound.played = true;
    } else if(readyOrders.length === 0) {
      doneSound.played = false;
    }
  }

  // Poll elke 5 seconden data bij API
  setInterval(async () => {
    await loadOrdersData();
    if(loggedInOperator) renderOperatorOrders();
    if(loggedInScreen) renderScreenOrders();
  }, 5000);

  // Status vertaling
  function statusText(status) {
    if(status === 'pending') return 'In Behandeling';
    if(status === 'ready') return 'Klaar';
    if(status === 'delayed') return 'Kan langer duren';
    return status;
  }

  // Start app
  handleRoute();

})();
</script>
</body>
</html>
