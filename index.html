<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Restaurant Operator</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: Arial, sans-serif; }
    body { background: #f4f4f4; color: #333; }
    #loginOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; align-items: center; justify-content: center; z-index: 999; }
    #loginBox { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px #000; }
    #appContainer { display: flex; height: 100vh; display: none; }
    #sidebar { width: 250px; background: #222; color: white; overflow-y: auto; padding: 10px; }
    .orderItem { padding: 10px; background: #333; margin-bottom: 5px; cursor: pointer; border-radius: 5px; }
    .orderItem:hover { background: #444; }
    #orderDetails { flex: 1; padding: 20px; background: white; display: flex; flex-direction: column; justify-content: space-between; }
    #detailsNote { background: #fefefe; border: 2px dashed #ccc; padding: 15px; min-height: 300px; margin-bottom: 20px; white-space: pre-wrap; }
    #statusSelect, #saveBtn { padding: 10px; font-size: 16px; margin-right: 10px; }
    #saveBtn { background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; }
    #saveBtn:hover { background: #218838; }
    #clientView { padding: 20px; text-align: center; }
  </style>
</head>
<body>

<div id="loginOverlay">
  <div id="loginBox">
    <h2 style="margin-bottom:10px;">Login</h2>
    <input type="text" id="username" placeholder="Username" style="padding:10px; width:100%; margin-bottom:10px;">
    <input type="password" id="password" placeholder="Password" style="padding:10px; width:100%; margin-bottom:10px;">
    <button onclick="handleLogin()" style="padding:10px 20px;">Login</button>
  </div>
</div>

<div id="appContainer">
  <div id="sidebar">
    <h3>Bestellingen</h3>
    <div id="ordersList"></div>
  </div>
  <div id="orderDetails">
    <div id="detailsNote">Selecteer een bestelling links.</div>
    <div>
      <select id="statusSelect">
        <option value="In behandeling">In behandeling</option>
        <option value="Klaar">Klaar</option>
      </select>
      <button id="saveBtn" onclick="saveStatus()">Opslaan</button>
    </div>
  </div>
</div>

<div id="clientView">
  <h2>Welkom bij het restaurant ðŸ‘‹</h2>
  <p>Alleen gastenmenu zichtbaar.</p>
</div>

<script>
const BIN_ID = "688f6efe7b4b8670d8ac3f46";
const API_KEY = "$2a$10$XpZeyd.RhynC0Ie0VWma7uJPbMYdUAIHuG24Smc5V0C5LU5d11H5O";

let currentOrder = null;
let currentData = [];

function fetchOrders() {
  fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
    headers: { 'X-Master-Key': API_KEY }
  })
  .then(res => res.json())
  .then(json => {
    currentData = json.record.orders || [];
    updateOrdersUI();
  });
}

function updateOrdersUI() {
  const list = document.getElementById("ordersList");
  list.innerHTML = '';
  currentData.forEach(order => {
    const div = document.createElement("div");
    div.className = "orderItem";
    div.innerText = `#${order.id} - ${order.status}`;
    div.onclick = () => showOrder(order);
    list.appendChild(div);
  });
}

function showOrder(order) {
  currentOrder = order;
  const details = document.getElementById("detailsNote");
  const itemsText = order.items.map(item => `â€¢ ${item.name} x${item.qty} - â‚¬${item.total.toFixed(2)}`).join("\n");
  details.innerText = `Bestelling #${order.id}\n\n${itemsText}\n\nOpmerkingen: ${order.opmerkingen || 'Geen'}\n\nTotaal: â‚¬${order.total.toFixed(2)}`;
  document.getElementById("statusSelect").value = order.status;
}

function saveStatus() {
  if (!currentOrder) return alert("Selecteer een bestelling.");
  const newStatus = document.getElementById("statusSelect").value;
  const orderIndex = currentData.findIndex(o => o.id === currentOrder.id);
  if (orderIndex > -1) {
    currentData[orderIndex].status = newStatus;
    pushOrders(currentData);
  }
}

function pushOrders(data) {
  fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
    method: "PUT",
    headers: {
      "Content-Type": "application/json",
      "X-Master-Key": API_KEY
    },
    body: JSON.stringify({ orders: data })
  }).then(() => fetchOrders());
}

function handleLogin() {
  const u = document.getElementById("username").value;
  const p = document.getElementById("password").value;
  if (u === "Operator" && p === "8008") {
    document.getElementById("loginOverlay").style.display = "none";
    document.getElementById("appContainer").style.display = "flex";
    document.getElementById("clientView").style.display = "none";
    fetchOrders();
    setInterval(fetchOrders, 3000);
  } else if (u === "OperatorScreen" && p === "8008") {
    alert("Display scherm komt nog bro ðŸ˜Ž");
    // later hier displaymode inbouwen
  } else {
    alert("Ongeldige gegevens.");
  }
}

document.addEventListener("keydown", (e) => {
  if (e.ctrlKey && e.shiftKey && e.key === "Z") {
    document.getElementById("loginOverlay").style.display = "flex";
  }
});
</script>

</body>
</html>
